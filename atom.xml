<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ENJOYHOT</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://enjoyhot.github.io/"/>
  <updated>2016-07-16T06:35:11.718Z</updated>
  <id>http://enjoyhot.github.io/</id>
  
  <author>
    <name>enjoyhot</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Stacking</title>
    <link href="http://enjoyhot.github.io/2016/07/08/Stacking/"/>
    <id>http://enjoyhot.github.io/2016/07/08/Stacking/</id>
    <published>2016-07-08T09:04:30.000Z</published>
    <updated>2016-07-16T06:35:11.718Z</updated>
    
    <content type="html">&lt;h1 id=&quot;测试blog&quot;&gt;&lt;a href=&quot;#测试blog&quot; class=&quot;headerlink&quot; title=&quot;测试blog&quot;&gt;&lt;/a&gt;测试blog&lt;/h1&gt;&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;相比 Blending，Stacking 能更好地利用训练数据。以 5-Fold Stacking 为例，它的基本原理如图所示：&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20160708170152466&quot; alt=&quot;stacking processing&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;整个过程很像 Cross Validation。&lt;br&gt;对于一个model，首先将训练数据分为 5 份，接下来一共5个迭代，每次迭代时，将 4 份数据作为 Training Set 对每个 Base Model 进行训练，然后在剩下一份 Hold-out Set 上进行预测。那么一个model训练最终将合成一个完整对于原始训练样本的预测单列矩阵。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;同时也要将其在测试数据上的预测保存下来。这样，每个 Base Model 在每次迭代时会对训练数据的其中 1 份做出预测，对测试数据的全部做出预测。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;多个model迭代都完成以后我们就获得了一个 #训练数据行数 x #Base Model 数量 的矩阵，这个矩阵接下来就作为第二层的 Model 的训练数据。当第二层的 Model 训练完以后，将之前保存的 Base Model 对测试数据的预测（因为每个 Base Model 被训练了 5 次，对测试数据的全体做了 5 次预测，所以对这 5 次求一个平均值形成一列，多个model形成多列，从而得到一个形状与第二层训练数据相同的矩阵）拿出来让它进行预测，就得到最后的输出。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;总的来说，Stacking 方法比任何单一模型的效果都要好，而且不仅成功应用在了监督式学习中，也成功应用在了非监督式(概率密度估计)学习中。甚至应用于估计bagging模型的错误率。据论文Feature-Weighted Linear Stacking(Sill, J. and Takacs, G. and Mackey L. and Lin D., 2009, arXiv:0911.0460)而言，Stacking比Bayesian Model Averaging表现要更好！此外在Kaggle上，很多比赛多是通过Stacking获取优秀的结果！&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;测试blog&quot;&gt;&lt;a href=&quot;#测试blog&quot; class=&quot;headerlink&quot; title=&quot;测试blog&quot;&gt;&lt;/a&gt;测试blog&lt;/h1&gt;&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;相比 Blending，Stacking 能更好地利用训练数据。以 5-Fold Stacking 为例，它的基本原理如图所示：&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20160708170152466&quot; alt=&quot;stacking processing&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Machine Learning" scheme="http://enjoyhot.github.io/categories/Machine-Learning/"/>
    
    
      <category term="ML foundation" scheme="http://enjoyhot.github.io/tags/ML-foundation/"/>
    
  </entry>
  
  <entry>
    <title>通过欢迎度对网页排名</title>
    <link href="http://enjoyhot.github.io/2015/05/03/%E9%80%9A%E8%BF%87%E6%AC%A2%E8%BF%8E%E5%BA%A6%E5%AF%B9%E7%BD%91%E9%A1%B5%E6%8E%92%E5%90%8D/"/>
    <id>http://enjoyhot.github.io/2015/05/03/通过欢迎度对网页排名/</id>
    <published>2015-05-03T07:30:50.000Z</published>
    <updated>2016-07-16T06:35:11.722Z</updated>
    
    <content type="html">&lt;p&gt;声明：由于此次第一次使用动态加载的表达式，hexo对LaTex支持可能不太好，因此这里有些公式显示奇奇怪怪，排版比较好一点的参考csdn:&lt;a href=&quot;http://blog.csdn.net/gugugujiawei/article/details/45459089&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;博客链接&lt;/a&gt;,下次就直接上图片算了。免得这边不兼容。&lt;/p&gt;
&lt;h1 id=&quot;一、欢迎度历史&quot;&gt;&lt;a href=&quot;#一、欢迎度历史&quot; class=&quot;headerlink&quot; title=&quot;一、欢迎度历史&quot;&gt;&lt;/a&gt;一、欢迎度历史&lt;/h1&gt;&lt;p&gt;1998年 Jon Kleinberg致力于HITS的万维网搜索引擎项目，其中的算法使用了万维网的超链接结构来改进搜索引擎所得的结果。&lt;/p&gt;
&lt;p&gt;同时，在离他很近的斯坦福大学里，两名博士生正在从事一项名为PageRank的类似项目，分别是Sergey Brin和Larry Page。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;这两个模型之间的联系令人吃惊。然而，Jon并未试图将HITS发展成为一家公司，不过后来企业家们却试着去做了，并因此而赋予了HITS那迟到的商业成功。搜索引擎Teoma的技术基础就是HITS算法的一个扩展。&lt;/p&gt;
&lt;p&gt;在介绍之前，我们先将万维网的超链接结构形成一个巨大的有向图，有向链接分为岀链和入链。&lt;/p&gt;
&lt;p&gt;网络有向图&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150503151630774&quot; alt=&quot;网络有向图&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;1-1-PageRank&quot;&gt;&lt;a href=&quot;#1-1-PageRank&quot; class=&quot;headerlink&quot; title=&quot;1.1 PageRank&quot;&gt;&lt;/a&gt;1.1 PageRank&lt;/h2&gt;&lt;p&gt;Pagerank的论点是，如果一个网页被其他重要的页面所指向，那它就是重要的。值得注意的是，推荐者的地位对推荐的作用是有一定联系的，也与推荐者推荐的总数有所关联。&lt;/p&gt;
&lt;h2 id=&quot;1-2-HITS&quot;&gt;&lt;a href=&quot;#1-2-HITS&quot; class=&quot;headerlink&quot; title=&quot;1.2 HITS&quot;&gt;&lt;/a&gt;1.2 HITS&lt;/h2&gt;&lt;p&gt;HITS定义了枢纽（hub）和权威（authority），这是网页的属性，当然一个网页可以两者都是。&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150503151736749&quot; alt=&quot;这里写图片描述&quot;&gt;&lt;br&gt;论点是，如果一个页面指向好的权威网页，那它就是一个好的枢纽网页（从而配上一个高的枢纽评分）；而如果一个网页被好的枢纽网页所指向，那它就是一个好的权威网页。&lt;/p&gt;
&lt;h2 id=&quot;1-3-查询相关性&quot;&gt;&lt;a href=&quot;#1-3-查询相关性&quot; class=&quot;headerlink&quot; title=&quot;1.3 查询相关性&quot;&gt;&lt;/a&gt;1.3 查询相关性&lt;/h2&gt;&lt;p&gt;如果每个页面的欢迎度评分是离线确定的，并且对于无论哪个查询而言（直至下次更新前）均保持恒定，则排名称为查询无关的&lt;br&gt;PageRank是查询无关的，HITS的原始版本是查询相关的。它们二者都可以修改为相反的那个类型。&lt;/p&gt;
&lt;h1 id=&quot;二、谷歌的PageRank数学&quot;&gt;&lt;a href=&quot;#二、谷歌的PageRank数学&quot; class=&quot;headerlink&quot; title=&quot;二、谷歌的PageRank数学&quot;&gt;&lt;/a&gt;二、谷歌的PageRank数学&lt;/h1&gt;&lt;h2 id=&quot;2-1-求和公式&quot;&gt;&lt;a href=&quot;#2-1-求和公式&quot; class=&quot;headerlink&quot; title=&quot;2.1 求和公式&quot;&gt;&lt;/a&gt;2.1 求和公式&lt;/h2&gt;&lt;p&gt;某个页面的Pi的PageRank记为r(Pi)，它是所有指向Pi的页面的PageRank之和。&lt;br&gt;$$ r(P&lt;em&gt;i) =\sum&lt;/em&gt;{P&lt;em&gt;j \in B&lt;/em&gt;{P_i}} \dfrac{r(P_j)}{|P&lt;em&gt;j|} $$&lt;br&gt;Bpi为指向Pi的页面集合，|Pj|是由Pj发出的岀链数量。&lt;br&gt;通过迭代的方式，解决通过未知页面的PageRank值得出另外未知页面的PageRank值。为了定义这一迭代过程，我们引入更多的记号，令$r&lt;/em&gt;{k+1}(P&lt;em&gt;i)$表示为页面Pi在第k+1次循环时的PageRank，则&lt;br&gt;$$ r&lt;/em&gt;{k+1}(P&lt;em&gt;i) =\sum&lt;/em&gt;{P&lt;em&gt;j \in B&lt;/em&gt;{P_i}} \dfrac{r_k(P_j)}{|P&lt;em&gt;j|}(1) $$&lt;br&gt;将所有页面Pi均具有$r&lt;/em&gt;{0}(P_i) =1/n$开始，并一直重复下去，直至收敛到稳定值。&lt;/p&gt;
&lt;h2 id=&quot;2-2求和方程的矩阵表示&quot;&gt;&lt;a href=&quot;#2-2求和方程的矩阵表示&quot; class=&quot;headerlink&quot; title=&quot;2.2求和方程的矩阵表示&quot;&gt;&lt;/a&gt;2.2求和方程的矩阵表示&lt;/h2&gt;&lt;p&gt;打个比方，以下面这个图为例&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150503151630774&quot; alt=&quot;网络有向图&quot;&gt;&lt;br&gt;我们引入一个n x n阶的矩阵H和一个1 x n阶的行向量$\pi^T$。矩阵H是一个行归一化超链接矩阵，则上图相应H为：&lt;br&gt;$$ H= \begin{matrix} \pmatrix{ 0 &amp;amp; 1/2 &amp;amp; 1/2 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 \ 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 \ 1/3 &amp;amp; 1/3 &amp;amp; 0 &amp;amp; 0 &amp;amp; 1/3 &amp;amp; 0 \ 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 1/2 &amp;amp; 1/2 \ 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 1/2 &amp;amp; 0 &amp;amp; 1/2 \ 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 1 &amp;amp; 0 &amp;amp; 0 \} \end{matrix} $$&lt;br&gt;向引入行向量$\pi^{(k)T}$，它表示在第k次循环时的PageRank向量。则(1)式可表示为：&lt;br&gt;$$\pi^{(k+1)T}=\pi^{(k)T}H (2)$$&lt;br&gt;从这个H矩阵可以看出一些端倪，书中总结出4个，我觉得关键在于在计算中通过矩阵计算降低复杂度，这在现实中是个稀疏矩阵，复杂度对于理论来说由平方降为1次。&lt;/p&gt;
&lt;h2 id=&quot;2-3迭代过程问题&quot;&gt;&lt;a href=&quot;#2-3迭代过程问题&quot; class=&quot;headerlink&quot; title=&quot;2.3迭代过程问题&quot;&gt;&lt;/a&gt;2.3迭代过程问题&lt;/h2&gt;&lt;p&gt;是否会收敛？收敛到唯一向量吗？是否与初始向量有关？收敛时间？&lt;/p&gt;
&lt;p&gt;以下分析为两位Google创始人解决的迭代问题。&lt;/p&gt;
&lt;p&gt;布林和佩奇最初利用$\pi^{(0)T}=1/ne^T$来开始迭代过程，但这可能导致排名下沉(rank sink)，譬如出现多个0，可比性降低，排名下沉很大程度上与悬挂节点（岀链为0）的出现有关。&lt;/p&gt;
&lt;p&gt;为了解决这个问题，他们使用了随机上网者的概念，对H矩阵进行调整，随机上网者特点为：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;随机岀链，包括悬挂节点&lt;/li&gt;
&lt;li&gt;随机上网者在某个特定页面上所停留的时间比例便是该页面相对重要性的一个度量&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;于是，我们将H矩阵变为随机矩阵S：&lt;br&gt;$$ S= \begin{matrix} \pmatrix{ 0 &amp;amp; 1/2 &amp;amp; 1/2 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 \ 1/6 &amp;amp; 1/6 &amp;amp; 1/6 &amp;amp; 1/6 &amp;amp; 1/6 &amp;amp; 1/6 \ 1/3 &amp;amp; 1/3 &amp;amp; 0 &amp;amp; 0 &amp;amp; 1/3 &amp;amp; 0 \ 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 1/2 &amp;amp; 1/2 \ 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 1/2 &amp;amp; 0 &amp;amp; 1/2 \ 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 1 &amp;amp; 0 &amp;amp; 0 \} \end{matrix} $$&lt;br&gt;可以证明，S是由H的一个秩一修正所给出的，即$S=H + a(1/n e^T)$，其中，若页面i为悬挂结点则ai=1，否则为0。二值向量a为悬挂结点向量，为列向量。&lt;/p&gt;
&lt;p&gt;然而，仅靠这一点还不够，未能达成存在唯一的正向量$\pi^T$ ,且方程能很快地收敛到$\pi^T$。要做到这一点，布林和佩奇做了另外一个调整，所谓的素性调整。&lt;strong&gt;有了这个调整，所得的矩阵就是随机的并且是素的。一个素矩阵是不可约的并且非周期的，因此，链的稳态向量存在且唯一&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;转换为素矩阵是基于这样一个论述的。上网者有时会在浏览器URL地址栏输入一个新的目的地，为了对这个行为进行数学建模，布林和佩奇创造了一个新的矩阵G如下：&lt;/p&gt;
&lt;p&gt;$$ G=\alpha S + (1-\alpha)1/n ee^T$$&lt;/p&gt;
&lt;p&gt;式中，a是一个0到1的标量(在之后的章节会反复提到a在谷歌中取0.85)，表示随机上网者根据万维网的超链接结构进行浏览的时间百分比。G成为&lt;strong&gt;谷歌矩阵&lt;/strong&gt;，$E=1/n ee^T$可称为跳转矩阵，是均匀分布的，即在进行跳转时是公平跳转。&lt;/p&gt;
&lt;p&gt;在书中，分为6点简单概括G带来的后果：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;G是随机的。&lt;/li&gt;
&lt;li&gt;G是不可约的。&lt;/li&gt;
&lt;li&gt;G是非周期的，Gii&amp;gt;0导致。&lt;/li&gt;
&lt;li&gt;G是素的。&lt;/li&gt;
&lt;li&gt;G是完全稠密的。从计算的角度，这是很糟糕的。但G可以写为非常稀疏的超链接矩阵H的秩一修正。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;\begin{align}&lt;br&gt;G &amp;amp;=\alpha S + (1-\alpha)1/n ee^T \&lt;br&gt;&amp;amp; =\alpha (H + a(1/n e^T)) + (1-\alpha)1/n ee^T \&lt;br&gt;&amp;amp; =\alpha H+[\alpha(a)+(1-\alpha)e]1/ne^T&lt;br&gt;\end{align}&lt;/p&gt;
&lt;p&gt;因此，谷歌修正后的PageRank法为&lt;br&gt;$$\pi^{（k+1）T}=\pi^{（k）T}G$$&lt;/p&gt;
&lt;h2 id=&quot;2-4-PageRank向量的计算&quot;&gt;&lt;a href=&quot;#2-4-PageRank向量的计算&quot; class=&quot;headerlink&quot; title=&quot;2.4 PageRank向量的计算&quot;&gt;&lt;/a&gt;2.4 PageRank向量的计算&lt;/h2&gt;&lt;p&gt;将求解$\pi^T$转换为如下特征向量问题&lt;br&gt;$$\pi^T=\pi^TG \&lt;br&gt;    \pi^Te=1$$&lt;br&gt;将求解$\pi^T$转换为求解如下的性齐次系统：&lt;br&gt;$$\pi^T(E-G)=0^T \&lt;br&gt;    \pi^Te=1$$&lt;br&gt;第一个系统为找到对应于主特征值$\lambda_1=1$的G的归一化主左特征向量。在第二个系统中，目标则是找到E-G的归一化左零向量。两个系统均服从归一化方程$\pi^Te=1$，该方程确保$\pi^T$是一个概率向量。&lt;/p&gt;
&lt;h3 id=&quot;2-4-1-幂法计算&quot;&gt;&lt;a href=&quot;#2-4-1-幂法计算&quot; class=&quot;headerlink&quot; title=&quot;2.4.1 幂法计算&quot;&gt;&lt;/a&gt;2.4.1 幂法计算&lt;/h3&gt;&lt;p&gt;PageRank矩阵G的特点使得幂法成为了显而易见的最佳选择。幂法是求取矩阵主特征值和特征向量的最古老同时也是最简单的迭代方法之一。缺点的计算速度缓慢。&lt;br&gt;\begin{align} \pi^{（k+1）T} &amp;amp; =\pi^{（k）T}G \ &amp;amp; =\alpha S + (1-\alpha)1/n \pi^{（k）T} ee^T \ &amp;amp; =\alpha (H + a(1/n e^T)) + (1-\alpha)1/n ee^T \ &amp;amp; =\alpha \pi^{（k）T} H+[\alpha \pi^{（k）T} a+1-\alpha]e^T/n \end{align}&lt;br&gt;式中，向量-矩阵乘法$\alpha \pi^{（k）T} H$执行于H这个极端稀疏的矩阵之上，而S和G从来就没有被实际生成或存储过，每个向量-矩阵乘法的复杂度为O(n)，因为H的每一行有差不多10个非零元素，这就是使用幂法的主要原因。&lt;br&gt;这里还有几个优点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;幂法中矩阵系数仅通过向量-矩阵乘法运算的程序来进行访问，而没有实际对矩阵加以操作。&lt;/li&gt;
&lt;li&gt;幂法存储方面，除了稀疏矩阵H和悬挂结点向量a之外，就只需要保存\alpha \pi^{（k）T}$了，这个向量是完全稠密的。&lt;/li&gt;
&lt;li&gt;迭代次数仅需50~100次。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;为什么仅需50次呢，解释一下，在马尔科夫链理论中给出了答案，一般而言，应用于某个矩阵的幂法的渐进收敛速率依赖于绝对值最大的两个特征值$\lambda_1$和$\lambda&lt;em&gt;2$的比值。确切来说，渐进收敛速率就是$ |\lambda&lt;/em&gt;/\lambda_1|^k \to 0 $的速率。&lt;/p&gt;
&lt;p&gt;对于G这样的随机矩阵，$\lambda_1=1$，由于G也是素的，因此$|\lambda_2|&amp;lt;1$。&lt;/p&gt;
&lt;p&gt;通过一些理论的支撑，有以下关系：&lt;br&gt;$$\lambda_k=\alpha \mu_k$$&lt;br&gt;其中$\mu_k&amp;lt;=1$&lt;/p&gt;
&lt;p&gt;在万维网结构中，$\mu_k$约等于1，因此，$|\mu_2(G)| \approx \alpha$。&lt;/p&gt;
&lt;p&gt;因此，渐进收敛速率在50次的情况为：&lt;br&gt;$$\alpha ^{50}=0.85^{50} \approx 0.000296$$&lt;br&gt;即在第50次迭代时，可以期望近似PageRank向量的精度大约为小数点后2~3位。这个精度已经足够了，当然要真正区分需要小数点后10位精度，但是当PageRank评分和内容评分结合起来之后，高精度就变得不那么重要了。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;声明：由于此次第一次使用动态加载的表达式，hexo对LaTex支持可能不太好，因此这里有些公式显示奇奇怪怪，排版比较好一点的参考csdn:&lt;a href=&quot;http://blog.csdn.net/gugugujiawei/article/details/45459089&quot;&gt;博客链接&lt;/a&gt;,下次就直接上图片算了。免得这边不兼容。&lt;/p&gt;
&lt;h1 id=&quot;一、欢迎度历史&quot;&gt;&lt;a href=&quot;#一、欢迎度历史&quot; class=&quot;headerlink&quot; title=&quot;一、欢迎度历史&quot;&gt;&lt;/a&gt;一、欢迎度历史&lt;/h1&gt;&lt;p&gt;1998年 Jon Kleinberg致力于HITS的万维网搜索引擎项目，其中的算法使用了万维网的超链接结构来改进搜索引擎所得的结果。&lt;/p&gt;
&lt;p&gt;同时，在离他很近的斯坦福大学里，两名博士生正在从事一项名为PageRank的类似项目，分别是Sergey Brin和Larry Page。&lt;br&gt;
    
    </summary>
    
      <category term="Search Engine" scheme="http://enjoyhot.github.io/categories/Search-Engine/"/>
    
    
      <category term="PageRank" scheme="http://enjoyhot.github.io/tags/PageRank/"/>
    
  </entry>
  
  <entry>
    <title>网络搜索引擎简介</title>
    <link href="http://enjoyhot.github.io/2015/04/21/%E7%BD%91%E7%BB%9C%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E7%AE%80%E4%BB%8B/"/>
    <id>http://enjoyhot.github.io/2015/04/21/网络搜索引擎简介/</id>
    <published>2015-04-21T05:23:50.000Z</published>
    <updated>2016-07-16T06:35:11.726Z</updated>
    
    <content type="html">&lt;h1 id=&quot;一、传统信息检索回顾&quot;&gt;&lt;a href=&quot;#一、传统信息检索回顾&quot; class=&quot;headerlink&quot; title=&quot;一、传统信息检索回顾&quot;&gt;&lt;/a&gt;一、传统信息检索回顾&lt;/h1&gt;&lt;p&gt;传统信息检索文档集的搜索有三种基本的计算机辅助技术：布尔模型、向量空间模型和概率模型。这些模型发展与20世纪60年代，直到2000年6月，便存在3500种不同的搜索引擎技术，并且大多数搜索引擎仍然依赖于以上三种基本模型的一种或数种。下图摘自《搜索引擎-原理技术与系统》，显示了搜索的主干流程。&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150421133224646&quot; alt=&quot;这里写图片描述&quot;&gt;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;##1.1 布尔搜索引擎&lt;br&gt;信息检索中最早而且最简单的检索方法之一。布尔逻辑检索也称作布尔逻辑搜索，严格意义上的布尔检索法是指利用布尔逻辑运算符连接各个检索词，然后由计算机进行相应逻辑运算，以找出所需信息的方法。它使用面最广、使用频率最高。布尔逻辑运算符的作用是把检索词连接起来，构成一个逻辑检索式。&lt;/p&gt;
&lt;p&gt;##1.2向量空间模型搜索引擎&lt;br&gt;向量空间模型将文本数据变换为数值向量和矩阵，然后使用矩阵分析方法来发现文档集中的关键特征和联系。某些高级向量空间模型，如LSI（Latent Semantic Indexing,隐性语义索引）等能访问文档集中隐含的语义结构，如搜索car,能返回automobile相关文档。&lt;br&gt;该模型还有另外两个优点是相关性评分和相关性反馈。缺点是计算开销大，查询时必须计算每个文档和查询之间的距离度量，因而也伴随着另一个缺点——向量空间模型无法很好地扩展。&lt;/p&gt;
&lt;h2 id=&quot;1-3概率模型搜索引擎&quot;&gt;&lt;a href=&quot;#1-3概率模型搜索引擎&quot; class=&quot;headerlink&quot; title=&quot;1.3概率模型搜索引擎&quot;&gt;&lt;/a&gt;1.3概率模型搜索引擎&lt;/h2&gt;&lt;p&gt;用户给定一个查询请求，概率检索模型根据文档与用户请求的相关性排序文档，给出结果，举个简单的例子，对于信息检索的文档，最可能跟在information后面的词是retrieval，但独立性假设却认为任何词都会以等概率出现在information后面。重点在于相关性的定义与衡量。概率模型的构建和编程有可能十分困难，它们的复杂度上升得很快。&lt;/p&gt;
&lt;p&gt;##1.4元搜索引擎&lt;br&gt;传统搜索引擎其实还有第四种模型，即元搜素引擎。它将以上三种经典模型合为一体。&lt;/p&gt;
&lt;p&gt;##1.5搜索引擎的比较&lt;br&gt;两种最为常用的评价不同搜索方法的评价指标是查准率和查全率。查准率是指检索所得相关文献的数量占总的检索所得文献数量的比例；查全率是指检索所得相关文献数量占总的相关文献数量的比例。查准率和查全率越高，搜索引擎就越好。&lt;/p&gt;
&lt;p&gt;#二、网络搜索引擎&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;爬虫模块：蜘蛛&lt;/li&gt;
&lt;li&gt;页面仓库：蜘蛛满载页面而回，它们暂时以完整页面的形式存放在页面仓库中，而在被送到索引建立模块之前，新的页面将一直留在仓库中。&lt;/li&gt;
&lt;li&gt;索引建立模块：取出每个新的未压缩页面，并从中仅抽取出最为重要的描述，以生成该页面在不同索引中的一个压缩描述。&lt;/li&gt;
&lt;li&gt;索引：分为内容索引和特殊用途索引（如图像索引和PDF索引）&lt;/li&gt;
&lt;li&gt;查询模块：将用户的自然语言查询转化为搜索系统可以理解的语言，然后查询不同的索引以便回答查询。&lt;/li&gt;
&lt;li&gt;排名模块：接收相关页面集，并根据某个判断依据对其进行排名。区分能力的排名是结合两个分数得到的，它们分别是内容评分和欢迎度评分，共同确定了相关页面的总评分，并按照总评分的顺序将页面集呈现给用户。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;#三、网络爬行、索引建立和查询处理&lt;/p&gt;
&lt;p&gt;##3.1 网络爬行&lt;br&gt;特点：&lt;br&gt;1.爬行是一个永不停歇的过程&lt;br&gt;2.蜘蛛访问网页时，需做到有礼貌的访问，即对网站的影响降到最小，不然可能会被“惩处”&lt;br&gt;3.多个蜘蛛协调合作，制定最佳爬行策略，节省时间和精力，尽可能提高效率&lt;/p&gt;
&lt;p&gt;##3.2 内容索引&lt;br&gt;程序将分析页面内容并抽取有价值的信息，从而仅将页面中最为关键的核心部分传给适当的索引。有价值的信息存在于标题、描述和锚文本中，此外还有粗体显示的项、大字体显示的项和超链接等。建立索引后形成倒排文件，形如：&lt;br&gt;什么是倒排文件？如下例子（其中001~004对应为文档编号）：&lt;br&gt;001 xxx142 张三 男 18 元培&lt;br&gt;002 xxx205 李四 女 17 哲学&lt;br&gt;003 xxx187 王五 男 19 生物&lt;br&gt;004 xxx325 赵六 女 18 元培&lt;br&gt;而我们利用倒排文件来实现上述非关键码的查询，就能大大提高速度。对于前面的情况设计倒排表如下：&lt;br&gt;男 001，003&lt;br&gt;女 002，004&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;16&lt;br&gt;17 002&lt;br&gt;18 001，004&lt;br&gt;19 003&lt;br&gt;20&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;元培 001，004&lt;br&gt;生物 003&lt;br&gt;哲学 002&lt;/p&gt;
&lt;p&gt;##3.3查询处理&lt;br&gt;查询处理的结果，将以文档的相关评分返回，举个例子。&lt;br&gt;在文档集中查询项a和项b的组合词ab，返回的结果有：&lt;br&gt;项a : 3[1,1,27],94[1,0,7],673[0,0,3]&lt;br&gt;项b : 3[1,1,10,94[0,0,5] ,673[1,1,14]&lt;br&gt;如94[1,0,7]中，1表示的是项a在页面94的标题中出现了，0表示项a在页面的描述标签未出现，7表示项a在页面94中出现了7次。&lt;br&gt;因此，内容得分可以这样来计算：&lt;br&gt;内容得分（页面3）= （1+1+27）x (1+1+10)=348&lt;br&gt;内容得分(页面94)=（1+0+7）x (0+0+5)=40&lt;br&gt;内容得分(页面673)=（0+0+3）x (1+1+14)=48&lt;/p&gt;
&lt;p&gt;有多种方案可以利用许多其它的因子来构成内容评分，这里只是随便举了一种。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;内容评分和欢迎度评分决定了一个网页的最终评分，由于本书的重点在与欢迎度评分，因为在之后的介绍中将不多涉及内容评分。&lt;/strong&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;一、传统信息检索回顾&quot;&gt;&lt;a href=&quot;#一、传统信息检索回顾&quot; class=&quot;headerlink&quot; title=&quot;一、传统信息检索回顾&quot;&gt;&lt;/a&gt;一、传统信息检索回顾&lt;/h1&gt;&lt;p&gt;传统信息检索文档集的搜索有三种基本的计算机辅助技术：布尔模型、向量空间模型和概率模型。这些模型发展与20世纪60年代，直到2000年6月，便存在3500种不同的搜索引擎技术，并且大多数搜索引擎仍然依赖于以上三种基本模型的一种或数种。下图摘自《搜索引擎-原理技术与系统》，显示了搜索的主干流程。&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150421133224646&quot; alt=&quot;这里写图片描述&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Search Engine" scheme="http://enjoyhot.github.io/categories/Search-Engine/"/>
    
    
      <category term="PageRank" scheme="http://enjoyhot.github.io/tags/PageRank/"/>
    
  </entry>
  
  <entry>
    <title>export CSDN blog to Markdown</title>
    <link href="http://enjoyhot.github.io/2015/03/29/CSDN2Markdown/"/>
    <id>http://enjoyhot.github.io/2015/03/29/CSDN2Markdown/</id>
    <published>2015-03-29T08:40:00.000Z</published>
    <updated>2016-07-16T06:35:11.690Z</updated>
    
    <content type="html">&lt;p&gt;#一、综述&lt;/p&gt;
&lt;p&gt;最开始的博客用的是oschina, 自我感觉小清新，支持比较多风格的编辑器，容易编辑程度比csdn的要好。后来因为csdn人气的关系，又转到csdn，不过csdn编辑确实比较虐心，再后来就在服务器上搭一个WordPress的博客，不过用起来不是很爽。几个月前支持Markdown编辑，这无疑给用github pages的用户一个福音，因为可以直接上传到自己的github博客上。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;用github pages生成静态的页面，目前比较流行有Jekyll,Octopress,Hexo等，其他的我没怎么调查，jekyll是github推荐的，上面有他们给的官方框架、主题，支持网页书写Markdown文章。后两者需要编译后再上传，github上呈现出来的是html文件。总体而言，后两者的界面更好，用起来更加舒适。我用的是Hexo，命令简洁，不过要注意备份整个工程，不然后果不堪设想。&lt;/p&gt;
&lt;p&gt;#二、迁移CSDN原文档到github Pages&lt;/p&gt;
&lt;p&gt;###1、前文&lt;br&gt;虽然目前CSDN支持markdown，但以前的文章都是用xeditor编辑器写的，不能导出，所以调研了方法。&lt;br&gt;总体而言有两种方法，但好像没多少人采用，因为格式可能不好。&lt;br&gt;1.爬取页面，导出html，然后在放在hexo中，目录为/source/_post/，直接放html文件，然后设置layout：false，那么hexo会忽略对html的编译，在浏览时直接超链接到html文件&lt;br&gt;2.将html文件再用程序转换为markdown&lt;br&gt;3.直接用代码爬取页面然后生成markdown文件&lt;/p&gt;
&lt;p&gt;第1种方法可能会遇到html文件中格式不支持的情况，没得到解决；&lt;br&gt;第2种方法发现在线转换效果也不好，就寻求代码解决，github上有一段&lt;a href=&quot;https://github.com/baizhebz/html2markdown4blog&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;程序&lt;/a&gt;，作者说可行，不过我环境没搭成功，不懂php，更何况要装curl（这个之前做android时NDK开发时也很难配置），后来用第3种方法就直接写python爬虫程序，参考github的一段&lt;a href=&quot;https://github.com/kesalin/PythonSnippet/blob/master/ExportCSDNBlog.py&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;程序&lt;/a&gt;，不过程序有些问题，也有些不符合如今CSDN的布局，所以我大改了一下，转为markdown的那一部分程序脉络是差不多的，这个也是最关键的部分，直接影响到markdown的显示，不过我也做得不太好。&lt;/p&gt;
&lt;p&gt;###2、程序&lt;br&gt;所需安装库：&lt;br&gt;BeautifulSoup&lt;br&gt;根据版本不同可能要改动相应的代码，一般不用改。&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;67&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;68&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;69&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;70&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;71&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;72&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;73&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;74&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;75&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;76&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;77&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;78&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;79&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;80&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;81&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;82&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;83&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;84&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;85&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;86&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;87&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;88&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;89&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;90&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;91&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;92&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;93&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;94&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;95&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;96&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;97&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;98&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;99&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;100&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;101&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;102&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;103&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;104&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;105&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;106&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;107&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;108&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;109&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;110&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;111&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;112&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;113&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;114&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;115&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;116&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;117&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;118&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;119&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;120&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;121&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;122&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;123&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;124&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;125&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;126&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;127&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;128&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;129&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;130&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;131&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;132&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;133&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;134&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;135&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;136&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;137&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;138&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;139&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;140&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;141&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;142&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;143&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;144&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;145&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;146&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;147&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;148&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;149&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;150&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;151&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;152&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;153&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;154&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;155&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;156&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;157&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;158&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;159&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;160&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;161&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;162&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;163&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;164&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;165&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;166&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;167&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;168&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;169&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;170&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;171&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;172&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;173&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;174&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;175&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;176&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;177&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;178&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;179&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;180&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;181&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;182&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;183&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;184&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;185&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;186&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;187&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;188&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;189&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;190&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;191&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;192&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;193&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;194&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;195&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;196&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;197&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;198&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;199&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;200&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;201&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;202&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;203&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;204&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;205&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;206&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;207&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;208&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;209&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;210&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;211&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;212&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;213&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;214&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;215&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;216&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;217&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;218&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;219&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;220&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;221&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;222&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;223&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;224&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;225&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;226&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;227&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;228&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;229&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;230&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;231&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;232&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;233&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;234&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;235&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;236&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;237&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;238&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;239&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;240&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;241&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;242&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;243&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;244&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;245&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;246&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;247&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;248&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;249&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;250&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;251&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;252&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;253&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#! /usr/bin/env python&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#coding=utf-8&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; urllib2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; bs4 &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; BeautifulSoup&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; logging&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; re&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; threading&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; traceback&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; time &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; datetime&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; sys&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;reload(sys)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sys.setdefaultencoding(&lt;span class=&quot;string&quot;&gt;&#39;gb18030&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# global variable&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;blog = &lt;span class=&quot;string&quot;&gt;&quot;http://blog.csdn.net&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;url = &lt;span class=&quot;string&quot;&gt;&quot;http://blog.csdn.net/gugugujiawei?viewmode=contents&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;outputDir = &lt;span class=&quot;string&quot;&gt;&#39;F:\\linux\\Share\\github\\article\\&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;gRetryCount = &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;decodeHtmlSpecialCharacter&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(htmlStr)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    specChars = &amp;#123;&lt;span class=&quot;string&quot;&gt;&quot;&amp;amp;ensp;&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;&amp;amp;emsp;&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;&amp;amp;nbsp;&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;&amp;amp;lt;&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;&amp;lt;&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;&amp;amp;gt&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;&amp;gt;&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;&amp;amp;amp;&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;&amp;amp;&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;&amp;amp;quot;&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;\&quot;&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;&amp;amp;copy;&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;®&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;&amp;amp;times;&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;×&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;&amp;amp;divide;&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;÷&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; key &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; specChars.keys():&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        htmlStr = htmlStr.replace(key, specChars[key])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; htmlStr&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;repalceInvalidCharInFilename&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(filename)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    specChars = &amp;#123;&lt;span class=&quot;string&quot;&gt;&quot;\\&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;/&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;:&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;*&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;?&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;\&quot;&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;&amp;lt;&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;小于&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;&amp;gt;&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot;大于&quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;|&quot;&lt;/span&gt; : &lt;span class=&quot;string&quot;&gt;&quot; and &quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &lt;span class=&quot;string&quot;&gt;&quot;&amp;amp;&quot;&lt;/span&gt; :&lt;span class=&quot;string&quot;&gt;&quot; or &quot;&lt;/span&gt;, \&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                 &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; key &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; specChars.keys():&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        filename = filename.replace(key, specChars[key])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; filename&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getPageUrlList&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(url)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;global&lt;/span&gt; blog&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#获取所有的页面的 url&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    user_agent = &lt;span class=&quot;string&quot;&gt;&#39;Mozilla/4.0 (compatible;  MSIE 5.5; Windows NT)&#39;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    header = &amp;#123; &lt;span class=&quot;string&quot;&gt;&#39;User-Agent&#39;&lt;/span&gt; : user_agent &amp;#125; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    request = urllib2.Request(url, &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;, header)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    response = urllib2.urlopen(request)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    data = response.read()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#print data&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    soup = BeautifulSoup(data)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    pageListDocs = soup.find_all(id=&lt;span class=&quot;string&quot;&gt;&quot;article_list&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# artclie----&amp;#123;url:title&amp;#125;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    articleUrlTitle = &amp;#123;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#print len(pageListDocs)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; pageList &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; pageListDocs:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        h1List = pageList.find_all(&lt;span class=&quot;string&quot;&gt;&#39;h1&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; articleList &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; h1List:            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            hrefDocs = articleList.find_all(&lt;span class=&quot;string&quot;&gt;&quot;a&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; len(hrefDocs) &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                articleHrefDoc = hrefDocs[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]                            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;#print &quot;hello&quot;,articleHrefDoc&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                articleUrl =  blog + articleHrefDoc[&lt;span class=&quot;string&quot;&gt;&quot;href&quot;&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                articleTitle = articleHrefDoc.text&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                articleUrlTitle[articleUrl] = articleTitle&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;the count of articles is&#39;&lt;/span&gt;,len(articleUrlTitle)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&#39;&#39;&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    for s in articleUrlTitle:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        print s,&#39;--&#39;,articleUrlTitle[s]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &#39;&#39;&#39;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; articleUrlTitle&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;download&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(url, title)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# 下载文章，并保存为 markdown 格式&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    logging.info(&lt;span class=&quot;string&quot;&gt;&quot; &amp;gt;&amp;gt; download: &quot;&lt;/span&gt; + url)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;downloading the article&#39;&lt;/span&gt;,title&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    data = &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    title = &lt;span class=&quot;string&quot;&gt;&#39;&quot;&#39;&lt;/span&gt; + title + &lt;span class=&quot;string&quot;&gt;&#39;&quot;&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    categories = &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    content = &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#postDate = datetime.datetime.now()&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;global&lt;/span&gt; gRetryCount&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    count = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; count &amp;gt;= gRetryCount:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        count = count + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt;:            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            time.sleep(&lt;span class=&quot;number&quot;&gt;2.0&lt;/span&gt;) &lt;span class=&quot;comment&quot;&gt;#访问太快会不响应&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            user_agent = &lt;span class=&quot;string&quot;&gt;&#39;Mozilla/4.0 (compatible;  MSIE 5.5; Windows NT)&#39;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            header = &amp;#123; &lt;span class=&quot;string&quot;&gt;&#39;User-Agent&#39;&lt;/span&gt; : user_agent &amp;#125;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            request = urllib2.Request(url, &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;, header)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            response = urllib2.urlopen(request)            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            data = response.read()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;except&lt;/span&gt; Exception,e:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            exstr = traceback.format_exc()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            logging.info(&lt;span class=&quot;string&quot;&gt;&quot; &amp;gt;&amp;gt; failed to download &quot;&lt;/span&gt; + url + &lt;span class=&quot;string&quot;&gt;&quot;, retry: &quot;&lt;/span&gt; + str(count) + &lt;span class=&quot;string&quot;&gt;&quot;, error:&quot;&lt;/span&gt; + exstr)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;pass&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; data == &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        logging.info(&lt;span class=&quot;string&quot;&gt;&quot; &amp;gt;&amp;gt; failed to download &quot;&lt;/span&gt; + url)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#print data&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    soup = BeautifulSoup(data)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#date=link_postdate&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    manageDocs = soup.find_all(&lt;span class=&quot;string&quot;&gt;&quot;div&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;article_manage&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; managerDoc &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; manageDocs:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        categoryDoc = managerDoc.find_all(&lt;span class=&quot;string&quot;&gt;&quot;span&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;link_categories&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; len(categoryDoc) &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:                            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            categories = categoryDoc[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;].a.get_text().encode(&lt;span class=&quot;string&quot;&gt;&#39;UTF-8&#39;&lt;/span&gt;).strip()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            categories  = categories.decode(&lt;span class=&quot;string&quot;&gt;&#39;utf-8&#39;&lt;/span&gt;).encode(&lt;span class=&quot;string&quot;&gt;&#39;gb2312&#39;&lt;/span&gt;)            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        postDateDoc = managerDoc.find_all(&lt;span class=&quot;string&quot;&gt;&quot;span&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;link_postdate&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; len(postDateDoc) &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            postDateStr = postDateDoc[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;].string.encode(&lt;span class=&quot;string&quot;&gt;&#39;UTF-8&#39;&lt;/span&gt;).strip()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            postDate = datetime.datetime.strptime(postDateStr, &lt;span class=&quot;string&quot;&gt;&#39;%Y-%m-%d %H:%M&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;date&#39;&lt;/span&gt;,postDate&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    contentDocs = soup.find_all(id=&lt;span class=&quot;string&quot;&gt;&quot;article_content&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; contentDoc &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; contentDocs:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        htmlContent = contentDoc.prettify().encode(&lt;span class=&quot;string&quot;&gt;&#39;UTF-8&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#print htmlContent&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#file = open(&#39;F:\\linux\\Share\\github\\out2.txt&#39;,&#39;a+&#39;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#file.write(htmlContent)        &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        content = htmlContent2String(htmlContent)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    exportToMarkdown(outputDir, postDate, categories, title, content)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# htmlContent2String 是整个程序的关键，用于将html转换为markdown格式&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;htmlContent2String&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(contentStr)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# 因为格式中可能会有点乱，换行符乱入，所以用[\s\S]匹配任何字符，包括换行符，注意其中的？是为了去除贪婪匹配&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# &amp;lt;img src=&quot;http://img.blog.csdn.net/20150118194525562&quot; align=&quot;middle&quot; width=&quot;400 height=&quot;300&quot; alt=&quot;&quot;&amp;gt; &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# 图片链接   &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    patternImg = re.compile(&lt;span class=&quot;string&quot;&gt;r&#39;(&amp;lt;img[\s\S]+?src=&quot;)([\s\S]+?)(&quot;[\s\S]+?&amp;gt;)&#39;&lt;/span&gt;)    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# &amp;lt;a target=&quot;_blank&quot; href=&quot;http://blog.csdn.net/gugugujiawei/article/details/42558411&quot;&amp;gt;博文&amp;lt;/a&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# 文字链接&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    patternHref = re.compile(&lt;span class=&quot;string&quot;&gt;r&#39;(&amp;lt;a[\s\S]+?href=&quot;)([\s\S]*?)(&quot;[\s\S]*?&amp;gt;)([\s\S]+?)(&amp;lt;/a&amp;gt;)&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# 去除html各种标签，这里的？则是指匹配0次或1次&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    patternRemoveHtml = re.compile(&lt;span class=&quot;string&quot;&gt;r&#39;&amp;lt;/?[^&amp;gt;]+&amp;gt;&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    resultContent = patternImg.sub(&lt;span class=&quot;string&quot;&gt;r&#39;![image_mark](\2)&#39;&lt;/span&gt;, contentStr)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    resultContent = patternHref.sub(&lt;span class=&quot;string&quot;&gt;r&#39;[\4](\2)&#39;&lt;/span&gt;, resultContent)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    resultContent = re.sub(patternRemoveHtml, &lt;span class=&quot;string&quot;&gt;r&#39;&#39;&lt;/span&gt;, resultContent)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    resultContent = decodeHtmlSpecialCharacter(resultContent)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#file = open(&#39;F:\\linux\\Share\\github\\out3.txt&#39;,&#39;a+&#39;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#file.write(resultContent)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; resultContent&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;exportToMarkdown&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(exportDir, postdate, categories, title, content)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    titleDate = postdate.strftime(&lt;span class=&quot;string&quot;&gt;&#39;%Y-%m&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    contentDate = postdate.strftime(&lt;span class=&quot;string&quot;&gt;&#39;%Y-%m-%d %H:%M:%S %z&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    filename = title&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    filename = repalceInvalidCharInFilename(filename)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    filepath = exportDir + filename + &lt;span class=&quot;string&quot;&gt;&#39;.txt&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#newFile = open(unicode(filepath, &quot;utf8&quot;), &#39;w&#39;) &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    newFile = open(filepath,&lt;span class=&quot;string&quot;&gt;&#39;a+&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# 根据自己需要选择去留注释,这里categores和tag用了一样的&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# newFile.write(&#39;---&#39; + &#39;\n&#39;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# newFile.write(&#39;layout: post&#39; + &#39;\n&#39;)    &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    newFile.write(&lt;span class=&quot;string&quot;&gt;&#39;title: &#39;&lt;/span&gt; + title + &lt;span class=&quot;string&quot;&gt;&#39;\n&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    newFile.write(&lt;span class=&quot;string&quot;&gt;&#39;date: &#39;&lt;/span&gt; + contentDate + &lt;span class=&quot;string&quot;&gt;&#39;\n&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# newFile.write(&#39;comments: true&#39; + &#39;\n&#39;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    newFile.write(&lt;span class=&quot;string&quot;&gt;&#39;categories: [&#39;&lt;/span&gt; + categories + &lt;span class=&quot;string&quot;&gt;&#39;]&#39;&lt;/span&gt; + &lt;span class=&quot;string&quot;&gt;&#39;\n&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    newFile.write(&lt;span class=&quot;string&quot;&gt;&#39;tags: [&#39;&lt;/span&gt; + categories + &lt;span class=&quot;string&quot;&gt;&#39;]&#39;&lt;/span&gt; + &lt;span class=&quot;string&quot;&gt;&#39;\n&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#newFile.write(&#39;description:&#39; + title + &#39;\n&#39;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# newFile.write(&#39;keywords: &#39; + categories + &#39;\n&#39;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    newFile.write(&lt;span class=&quot;string&quot;&gt;&#39;---&#39;&lt;/span&gt; + &lt;span class=&quot;string&quot;&gt;&#39;\n\n&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    content = content.decode(&lt;span class=&quot;string&quot;&gt;&#39;utf-8&#39;&lt;/span&gt;).encode(&lt;span class=&quot;string&quot;&gt;&#39;gb18030&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#print content&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    newFile.write(content)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    newFile.write(&lt;span class=&quot;string&quot;&gt;&#39;\n&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    newFile.close()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; __name__ == &lt;span class=&quot;string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;global&lt;/span&gt; url    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    articleUrlTitle = getPageUrlList(url)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&#39;&#39;&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    for s in articleUrlTitle:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        print s,&#39;--&#39;,articleUrlTitle[s]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &#39;&#39;&#39;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#multithread download&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    threads = []&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; url &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; articleUrlTitle:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        patternTitle = re.compile(&lt;span class=&quot;string&quot;&gt;&#39;\r\n *(.+) *\r\n&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        title = patternTitle.sub(&lt;span class=&quot;string&quot;&gt;r&#39;\1&#39;&lt;/span&gt;,articleUrlTitle[url])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;# print &#39;title&#39;,title&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        t = threading.Thread(target = download,args = (url,title))    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        t.start()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        threads.append(t)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; threads:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        i.join()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;success&quot;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;注意一下，我是直接在windows下运行生成的txt文件，所以文件时dos文件，当在linux下编辑的话会出现各种因格式问题导致的奇怪的问题，这需要自己改一下编码。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;#一、综述&lt;/p&gt;
&lt;p&gt;最开始的博客用的是oschina, 自我感觉小清新，支持比较多风格的编辑器，容易编辑程度比csdn的要好。后来因为csdn人气的关系，又转到csdn，不过csdn编辑确实比较虐心，再后来就在服务器上搭一个WordPress的博客，不过用起来不是很爽。几个月前支持Markdown编辑，这无疑给用github pages的用户一个福音，因为可以直接上传到自己的github博客上。&lt;br&gt;
    
    </summary>
    
      <category term="life" scheme="http://enjoyhot.github.io/categories/life/"/>
    
    
      <category term="CSDN" scheme="http://enjoyhot.github.io/tags/CSDN/"/>
    
      <category term="markdown" scheme="http://enjoyhot.github.io/tags/markdown/"/>
    
  </entry>
  
  <entry>
    <title>photos</title>
    <link href="http://enjoyhot.github.io/2015/03/26/myphoto/"/>
    <id>http://enjoyhot.github.io/2015/03/26/myphoto/</id>
    <published>2015-03-26T15:45:21.000Z</published>
    <updated>2016-07-16T06:35:11.706Z</updated>
    
    <content type="html">&lt;p&gt;say something show&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;say something show&lt;/p&gt;

    
    </summary>
    
      <category term="photo" scheme="http://enjoyhot.github.io/categories/photo/"/>
    
    
      <category term="photo" scheme="http://enjoyhot.github.io/tags/photo/"/>
    
  </entry>
  
  <entry>
    <title>HPC集群平台搭建概念</title>
    <link href="http://enjoyhot.github.io/2015/03/24/HPC-cluster/"/>
    <id>http://enjoyhot.github.io/2015/03/24/HPC-cluster/</id>
    <published>2015-03-24T12:23:50.000Z</published>
    <updated>2016-07-16T06:35:11.694Z</updated>
    
    <content type="html">&lt;p&gt;　　在本文之前，我建议先看完这篇文章：&lt;a href=&quot;http://www.jointforce.com.cn/page/hardware_linux.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Linux高性能计算集群 – Beowulf集群&lt;/a&gt;　　&lt;/p&gt;
&lt;p&gt;#一、搭建集群中可能会遇到的问题&lt;/p&gt;
&lt;p&gt;1.集群设计/布局的一大难点就是网络，各家有各家的策略，一般围绕Beowulf变型。&lt;br&gt;2.软件的部署缺乏实操调试，也不能断定这样部署是否成功以及是否优越。&lt;br&gt;3.操作系统的选型以及安装系统、所需软件（包括集群管理工具、驱动软件、能耗监控软件等）的整个流程的手动/自动化部署。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;4.每个提供硬件的对应公司几乎都推出他们自己的集群管理软件，浪潮好像没有，在HPC方面浪潮好像没有相应的开发社区，DELL和IBM这些大公司都有。&lt;br&gt;5.能耗的衡量，具体的优化方向和策略。&lt;/p&gt;
&lt;p&gt;#二、HPC概览&lt;/p&gt;
&lt;p&gt;##①总体构成&lt;br&gt;    Outside Network: 外部网络&lt;br&gt;    Master Node: 主节点&lt;br&gt;    Compute Nodes: 计算节点&lt;br&gt;    Storage: 存储器&lt;br&gt;    Computational Network: 计算网络&lt;br&gt;    Management Network: 管理网络&lt;/p&gt;
&lt;p&gt;##②大多数 HPCC 系统配有两个网络&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;基于TCP的管理网络&lt;/li&gt;
&lt;li&gt;计算网络，可以是基于 TCP 或其它协议的，通常是 InfiniBand 或 Myrinet 10G 之    类的高速网络&lt;br&gt;##③拓扑图&lt;br&gt;网上找的普遍认可的：&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150324151225653&quot; alt=&quot;这里写图片描述&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150324151208655&quot; alt=&quot;这里写图片描述&quot;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;这个是自己根据实际情况“臆想”的：&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150324151438331&quot; alt=&quot;这里写图片描述&quot;&gt;&lt;/p&gt;
&lt;p&gt;##④所需软件组件（按安装顺序）：&lt;/p&gt;
&lt;p&gt;###1、对于安装系统：&lt;br&gt;　　集群中的每个节点（HPCC 节点文章链接）、主节点、登录节点和计算节点都需要有操作系统。操作系统可以安装在节点的硬盘驱动器上，甚至可以安装在ramdisk 上，这有时被称为“无盘”或“无状态”节点。一般说来，主节点创建所谓的“映像”，然后将其发送到计算节点上进行安装（硬盘驱动器或 ramdisk 上）。&lt;br&gt;　　系统装在内存会更快，但断电后要采取将系统拷贝到硬盘的方法重新存储起来，比较麻烦。&lt;br&gt;　　&lt;br&gt;　　&lt;strong&gt;几种安装工具的特点：&lt;/strong&gt;&lt;br&gt;　　&lt;img src=&quot;http://img.blog.csdn.net/20150324151858809&quot; alt=&quot;这里写图片描述&quot;&gt;&lt;/p&gt;
&lt;p&gt;　　但是，比较有名有Rocks（比xCat安装简单）、xCat。&lt;br&gt;　　&lt;strong&gt;xCAT:&lt;/strong&gt;&lt;br&gt;a、支持自己系统独立，可以自己选择基于RHEL的最新版本系统；&lt;br&gt;b、命令行安装，需要人工编辑配置文件，安装一台之后再利用脚本进行网络安装裸机节点；&lt;br&gt;c、xCat在安装起来像一个个独立软件，如其他并行计算需要的相关软件可以通过xCat命令安装；&lt;br&gt;　　&lt;strong&gt;Rocks:&lt;/strong&gt;&lt;br&gt;a、ROCKS 基于 Red Hat 发行版，这对于大多数人是合适的，但是对于使用 SUSE 或者希望使用在 RH 6.2 发行版上创建的映像的人就不合适了，里面的软件可以选择性安装。另外，ROCKS 不是克隆解决方案；&lt;br&gt;b、之前需刻录CD，GUI界面部署，之后人工进行节点命名和节点ip的配置，安装时一台一台进行；&lt;br&gt;c、Rocks则像一个集成的包，包含工具与软件；&lt;br&gt;Rocks = CentOS + Rolls&lt;br&gt;Roll软件包包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;base：基本的Rocks Cluster管理工具&lt;/li&gt;
&lt;li&gt;SGE：SUN Grid Engine，集群下作业调度&lt;/li&gt;
&lt;li&gt;HPC：为集群上的并行应用提供运行环境（MPI，PVM）&lt;/li&gt;
&lt;li&gt;area51：分析集群上文件和内核的完整性&lt;/li&gt;
&lt;li&gt;Ganglia：集群监控软件（主流hpc cluster基本都有这个）&lt;/li&gt;
&lt;li&gt;Bio：集群的生物信息学工具&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一般而言，这两种方法只有适用性与便捷性的差异。&lt;br&gt;有一个视频课程 &lt;a href=&quot;http://edu.51cto.com/course/course_id-507.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://edu.51cto.com/course/course_id-507.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;　　对于操作系统的选择，调研了很多，一般用Red Hat，Centos居多，一方面是社区活跃，一方面是源码开发，资源兼容较多。&lt;br&gt;（MIC开发上基本采用Red Hat，Centos，SUSE，windows也开始有了）&lt;/p&gt;
&lt;p&gt;###2、安装驱动和开发工具。&lt;br&gt;包括IB驱动、编译器、编辑器、调试器、库等。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;并行计算开发环境：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;安装英特尔众核平台软件堆栈(MPSS)，包含各种驱动。&lt;br&gt;&lt;a href=&quot;https://software.intel.com/en-us/articles/intel-manycore-platform-software-stack-mpss#lx34rel&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://software.intel.com/en-us/articles/intel-manycore-platform-software-stack-mpss#lx34rel&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;假如用intel的编译器的话（我们应该是用intel的）：&lt;br&gt;下载安装intel parallel studio xe 2015，包含有性能分析工具、编译器、高性能库、并行编程工具等，对Xeon Phi进行相应的优化和升级。 Cilk Plus，OpenMP，TBB多线程编程技术和向量化技术在Xeon &amp;amp; Xeon Phi上都已实现了，软件开发者无需额外的移植成本。（试用30天）&lt;br&gt;&lt;a href=&quot;https://software.intel.com/en-us/intel-parallel-studio-xe/try-buy&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://software.intel.com/en-us/intel-parallel-studio-xe/try-buy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;xeon phi与第三方工具是否available，参考Intel FAQ：&lt;br&gt;&lt;a href=&quot;https://software.intel.com/en-us/articles/intel-and-third-party-tools-and-libraries-available-with-support-for-intelr-xeon-phitm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://software.intel.com/en-us/articles/intel-and-third-party-tools-and-libraries-available-with-support-for-intelr-xeon-phitm&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;###3、配置节点信息存储系统&lt;br&gt;安装NFS、PVFS、Lustre 、Luster、GPFS、SNFS等，一般大型的HPC集群用Lustre能获得更好的性能，但不太适合小集群，小集群可以考虑用NFS和PVFS，但NFS并不是面向并行计算的，推荐用PVFS好一点。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;关于Lustre：&lt;/strong&gt;&lt;br&gt;　　一个Lustre文件系统主要包括以下四个组件：管理服务器Management Server(mgs), 元数据服务器Meta Data Target(mdt), 对象存储服务器Object Storge Target(ost) ,客户端Lustre clients(lc)。&lt;br&gt;　　它主要包括三个部分：元数据服务器MDS (Metadata Server)、对象存储服务器OSS (Object Storage Server)和客户端Client。&lt;br&gt;　　正常的启动顺序是：OST -&amp;gt; MDS -&amp;gt; CLIENT&lt;/p&gt;
&lt;p&gt;　　甲骨文产品管理负责人Bob Thome表示：“云文件系统并不是甲骨文首个基于集群文件系统的产品。甲骨文管理着Lustre项目，Lustre更适合于拥有上千台服务器的大规模HPC（高性能计算）部署。云文件系统则更适合于25个节点数左右的小规模部署，尽管Lustre已经通过了多达100个节点的测试。Lustre也可以实现很多相同的功能，但使用门槛较高，安装和配置较为繁琐，并不适合于小规模部署。”&lt;br&gt;　　关于Lustre的博文：&lt;a href=&quot;http://www.cnblogs.com/jpa2/category/384788.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.cnblogs.com/jpa2/category/384788.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;PVFS存在以下不足：&lt;/strong&gt;&lt;br&gt;1）单一管理节点。上面说到过PVFS中只有一个管理节点来管理元数据，当集群系统达到一定的规模之后，管理节点将可能出现过度繁忙的情况，这时管理节点将成为系统瓶颈。&lt;br&gt;2）对数据的存储缺乏容错机制。当某一I/O节点无法工作时，上面的数据将出现不可用的情况。&lt;br&gt;3）静态配置。对PVFS的配置只能在启动前进行，一旦系统运行则不可再更改原先的配置。&lt;/p&gt;
&lt;p&gt;###4、集群管理工具（考虑是否集成了一些组件）&lt;br&gt;　　集群管理工具 (CMT)，它的职能是管理集群。它有多个功能，有的是可选功能。而必须具备的功能包括:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;维护计算节点清单（即集群中包括的节点）。只需通过简单如 /etc/hosts 的，就能复制或通过本地 DNS 发送至每个计算节点&lt;/li&gt;
&lt;li&gt;创建、管理映像或安装在计算节点上的数据包集&lt;/li&gt;
&lt;li&gt;发送映像或数据包到计算节点（一般通过 PXE ）&lt;/li&gt;
&lt;li&gt;执行对计算节点的基本监控（例如，节点工作情况？什么节点发生起落？）&lt;/li&gt;
&lt;li&gt;计算节点电源控制（不是硬性要求，但是强烈推荐）。即远程开启/关闭节点，此功能可以通过各种方法实现，有的方法需要使用增加其他硬件。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;虽然这个功能清单对于有集群经验的人来说显得太简短，但清单所载功能是 CMT真正的核心。具备其他功能也不错，但对集群来说并不是必不可少的。&lt;/p&gt;
&lt;p&gt;　　CMT 包括 Platform OCS、Clustercorp ROCKS+、Microsoft Windows CCS 和平台管理器 (Platform Manager) 、Mon等。&lt;/p&gt;
&lt;p&gt;###5、可选组件：&lt;br&gt;　　集群所需的工具并不多，但有了这些就能实现集群的基本运行。不过，它只能满足 1 个用户或 2 至 3 个用户的需要，此外，要实现全面控制和掌握集群的运行情况。要安装一些可选组件，从技术上虽然是可选项，但是没有这些工具，集群就不具备生产能力。&lt;br&gt;有一些组件可以添加到 CMT 或 CMI 上层。一个有数年管理多个集群经验的人说的，强烈建议您郑重考虑使用以下附加组件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;更加广泛的监控工具，包括集群状态图形视图，例如Ganglia（链接- &lt;a href=&quot;http://ganglia.info/）、Cacti（链接&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://ganglia.info/）、Cacti（链接&lt;/a&gt; - &lt;a href=&quot;http://www.cacti.net/）和&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.cacti.net/）和&lt;/a&gt; Nagios（链接 -&lt;a href=&quot;http://www.nagios.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.nagios.org/&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;报告工具，允许您创建关于集群运行情况的报告&lt;/li&gt;
&lt;li&gt;用户帐户管理工具（允许您在整个集群上创建用户帐号、允许用户设置密码，然后将其传播到集群的所有节点上，允许无密码登录节点，这对于运行 MPI 应用程序是必需的）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;另一个理论上可选，但值得强烈推荐的组件——任务调度器（也被称为资源管理器）任务调度器是一个允许用户提交执行任务、但不参与任务运行的排队系统。任务调度器把提交的任务排成队列，等到资源（即节点）可用时，就开始运行。任务调度器包括：Platform LSF、PBS-Pro 和 MOAB 等。&lt;/p&gt;
&lt;p&gt;###6、测试&lt;br&gt;略&lt;/p&gt;
&lt;p&gt;#三、参考链接：&lt;br&gt;&lt;a href=&quot;http://www.ibm.com/developerworks/cn/linux/l-cluster1/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.ibm.com/developerworks/cn/linux/l-cluster1/&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://zh.community.dell.com/techcenter/w/techcenter_wiki/50&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://zh.community.dell.com/techcenter/w/techcenter_wiki/50&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.hpcblog.com.cn/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.hpcblog.com.cn/&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;附上一张高清MIC图：&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150324154126054&quot; alt=&quot;这里写图片描述&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;　　在本文之前，我建议先看完这篇文章：&lt;a href=&quot;http://www.jointforce.com.cn/page/hardware_linux.html&quot;&gt;Linux高性能计算集群 – Beowulf集群&lt;/a&gt;　　&lt;/p&gt;
&lt;p&gt;#一、搭建集群中可能会遇到的问题&lt;/p&gt;
&lt;p&gt;1.集群设计/布局的一大难点就是网络，各家有各家的策略，一般围绕Beowulf变型。&lt;br&gt;2.软件的部署缺乏实操调试，也不能断定这样部署是否成功以及是否优越。&lt;br&gt;3.操作系统的选型以及安装系统、所需软件（包括集群管理工具、驱动软件、能耗监控软件等）的整个流程的手动/自动化部署。&lt;br&gt;
    
    </summary>
    
      <category term="HPC" scheme="http://enjoyhot.github.io/categories/HPC/"/>
    
    
      <category term="cluster" scheme="http://enjoyhot.github.io/tags/cluster/"/>
    
  </entry>
  
  <entry>
    <title>HPC性能测试</title>
    <link href="http://enjoyhot.github.io/2015/03/24/hpc-benchmark/"/>
    <id>http://enjoyhot.github.io/2015/03/24/hpc-benchmark/</id>
    <published>2015-03-24T06:43:00.000Z</published>
    <updated>2016-07-16T06:35:11.694Z</updated>
    
    <content type="html">&lt;p&gt;#一、介绍&lt;/p&gt;
&lt;p&gt;　　说到高性能计算，一般都是利用搭建集群配合加速卡做并行计算实现。但用相同的硬件实现更快的方法，那就是做测试了。比较有名的就是Linpack测试了，Linpack现在在国际上已经成为最流行的用于测试高性能计算机系统浮点性能的benchmark，在高性能领域，就是利用其中的HPL测试进行测试。下面摘一段百科上的解释:&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;　　&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;　　Linpack现在在国际上已经成为最流行的用于测试高性能计算机系统浮点性能的benchmark。通过利用高性能计算机，用高斯消元法求解N元一次稠密线性代数方程组的测试，评价高性能计算机的浮点性能。&lt;br&gt;　　Linpack测试包括三类，Linpack100、Linpack1000和HPL。Linpack100求解规模为100阶的稠密线性代数方程组，它只允许采用编译优化选项进行优化，不得更改代码，甚至代码中的注释也不得修改。Linpack1000要求求解规模为1000阶的线性代数方程组，达到指定的精度要求，可以在不改变计算量的前提下做算法和代码上做优化。HPL即High Performance Linpack，也叫高度并行计算基准测试，它对数组大小N没有限制，求解问题的规模可以改变，除基本算法（计算量）不可改变外，可以采用其它任何优化方法。前两种测试运行规模较小，已不是很适合现代计算机的发展，因此现在使用较多的测试标准为HPL，而且阶次N也是linpack测试必须指明的参数。&lt;br&gt;　　HPL是针对现代并行计算机提出的测试方式。用户在不修改任意测试程序的基础上，可以调节问题规模大小N(矩阵大小)、使用到的CPU数目、使用各种优化方法等来执行该测试程序，以获取最佳的性能。HPL采用高斯消元法求解线性方程组。当求解问题规模为N时，浮点运算次数为(2/3 &lt;em&gt; N^3－2&lt;/em&gt;N^2)。因此，只要给出问题规模N，测得系统计算时间T，峰值=计算量(2/3 &lt;em&gt; N^3－2&lt;/em&gt;N^2)/计算时间T，测试结果以浮点运算每秒（Flops）给出。&lt;br&gt;　　&lt;br&gt;计算峰值：&lt;br&gt;　　随着产品硬件的不断的升级，整个的计算能力也以数量级的速度提升。衡量计算机性能的一个重要指标就是计算峰值，例如浮点计算峰值，它是指计算机每秒钟能完成的浮点计算最大次数。包括理论浮点峰值和实测浮点峰值：&lt;br&gt;　　理论浮点峰值是该计算机理论上能达到的每秒钟能完成浮点计算最大次数，它主要是由CPU的主频决定的，&lt;br&gt;理论浮点峰值=CPU主频×CPU每个时钟周期执行浮点运算的次数×系统中CPU核心数目&lt;br&gt;　　实测浮点峰值是指Linpack测试值，也就是说在这台机器上运行Linpack测试程序，通过各种调优方法得到的最优的测试结果。实际上在实际程序运行过程中，几乎不可能达到实测浮点峰值，更不用说达到理论浮点峰值了。这两个值只是作为衡量机器性能的一个指标，用来表明机器处理能力的一个标尺和潜能的度量。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;　　此次参加一个高性能的比赛，虽然做的是平台搭建部分，但对此也有些了解。也了解了一下HPCC测试和NAMD测试，下面主要分这两部分来说一下。&lt;/p&gt;
&lt;p&gt;#二、正文&lt;/p&gt;
&lt;h3 id=&quot;1、HPCC&quot;&gt;&lt;a href=&quot;#1、HPCC&quot; class=&quot;headerlink&quot; title=&quot;1、HPCC&quot;&gt;&lt;/a&gt;1、HPCC&lt;/h3&gt;&lt;p&gt; 　　HPCC 全称 HPC Chanllenge Benchmark&lt;/p&gt;
&lt;p&gt;　　Benchmark 是指一组用来评估硬件或者软件相关性能的基准测试程序&lt;/p&gt;
&lt;p&gt;　　HPC Chanllenge Benchmark 由一组benchmark组成，共计7个，分别测试了系统7个方面的性能，这7个分别为：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HPL &lt;/li&gt;
&lt;li&gt;stream&lt;/li&gt;
&lt;li&gt;Random Access&lt;/li&gt;
&lt;li&gt;PTRANS,&lt;/li&gt;
&lt;li&gt;Latency/Bandwidth&lt;/li&gt;
&lt;li&gt;FFT&lt;/li&gt;
&lt;li&gt;DGEMM&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;stream&lt;/strong&gt;：测试内存带宽&lt;br&gt;内存看作是内存控制器与CPU之间的桥梁与仓库。内存的容量决定“仓库”的大小，而内存的带宽决定“桥梁”的宽窄&lt;br&gt;&lt;strong&gt;Random Access&lt;/strong&gt;：测试内存刷新的速率（随机存储中电容器需要刷新）&lt;br&gt;&lt;strong&gt;PTRANS&lt;/strong&gt;：通过多处理器结构中两两之间的通信，来衡量在整个网络的通信能力&lt;br&gt;&lt;strong&gt;Latency/Bandwidth&lt;/strong&gt;：测试延时与带宽&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Latency：8 byte 数据从一个节点到另一个节点所需时间&lt;/li&gt;
&lt;li&gt;Bandwidth：节点间网络通信的带宽&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;HPL&lt;/strong&gt;：测试系统在解线性方程组时进行浮点运算的性能&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;浮点运算：超级计算机应用的场景主要是在科学计算，经常涉及矩阵运算、各种数值模拟等。&lt;/li&gt;
&lt;li&gt;超级计算机经常以FLOPS（每秒浮点运算次数）去衡量计算能力&lt;/li&gt;
&lt;li&gt;HPCC里有3种benchmark是测试浮点计算性能的&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;FFT&lt;/strong&gt;：涉及到双精度一维离散傅里叶变换时，浮点运算的速度&lt;br&gt;&lt;strong&gt;DGEMM&lt;/strong&gt;：在做双精度矩阵乘法时，浮点运算的速度&lt;/p&gt;
&lt;p&gt;HPCC的下载地址见：&lt;a href=&quot;http://icl.cs.utk.edu/hpcc/software/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;链接&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;　　这个软件13年8月后就没更新了，网上查阅了很多资料，发现使用的人好像也不多，对于高性能计算，大多都是HPL的文章和测试。要想使用好这个软件，需要研读其源代码。&lt;br&gt;　　其中的安装使用方法可参照网站的&lt;strong&gt;FAQ&lt;/strong&gt;以及软件中的&lt;strong&gt;README.html&lt;/strong&gt;&lt;br&gt;　　编译之前，需要下载好相关的库，包括MPI（mpich，mpich2，mvapich，openmpi，platform_mpi，hpmpi……）、MKL/BLAS/GotoBLAS2……、C语言编译器等，前两者集群一般需要自己去找对应的软件，详细配置请自行上网搜一下，和Linpack基本一样。&lt;/p&gt;
&lt;p&gt;###2、NAMD测试&lt;/p&gt;
&lt;p&gt;　　NAMD是一个与分子动力学有关，用来高仿真大型生物分子系统的程序。即生物分子建模程序。&lt;br&gt;　　现提供两个工作负载apoa1, f1atpase&lt;br&gt;　　它们可以从 &lt;a href=&quot;http://www.ks.uiuc.edu/Research/namd/utilities/f1atpase.tar.gz和http://www.ks.uiuc.edu/Research/namd/utilities/apoa1.tar.gz下载。&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.ks.uiuc.edu/Research/namd/utilities/f1atpase.tar.gz和http://www.ks.uiuc.edu/Research/namd/utilities/apoa1.tar.gz下载。&lt;/a&gt;
　　&lt;/p&gt;
&lt;p&gt;至于性能的话，且看图：&lt;br&gt;　　&lt;img src=&quot;http://img.blog.csdn.net/20150324144222556&quot; alt=&quot;http://www.ks.uiuc.edu/Research/namd/performance.html&quot;&gt;&lt;/p&gt;
&lt;p&gt;图片来源：&lt;a href=&quot;http://www.ks.uiuc.edu/Research/namd/performance.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;链接&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;NAMD 2.8 在天津超算天河-1A上的测试结果：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;表1 每节点不同进程数以及使用不同节点数的NAMD性能（days/ns）比较&lt;/strong&gt;&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150324144513425&quot; alt=&quot;数据&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150324144634870&quot; alt=&quot;这里写图片描述&quot;&gt;&lt;/p&gt;
&lt;p&gt;　　结论：为了在天河上达到性能最优，最佳的方案是使用GPU，并且每个节点开6个进程。参照：&lt;a href=&quot;http://blog.sina.com.cn/s/blog_a43b3cf2010157pz.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;链接&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;#一、介绍&lt;/p&gt;
&lt;p&gt;　　说到高性能计算，一般都是利用搭建集群配合加速卡做并行计算实现。但用相同的硬件实现更快的方法，那就是做测试了。比较有名的就是Linpack测试了，Linpack现在在国际上已经成为最流行的用于测试高性能计算机系统浮点性能的benchmark，在高性能领域，就是利用其中的HPL测试进行测试。下面摘一段百科上的解释:&lt;br&gt;
    
    </summary>
    
      <category term="HPC" scheme="http://enjoyhot.github.io/categories/HPC/"/>
    
    
      <category term="benchmark" scheme="http://enjoyhot.github.io/tags/benchmark/"/>
    
  </entry>
  
  <entry>
    <title>学习感悟</title>
    <link href="http://enjoyhot.github.io/2015/03/19/study-thinking-20150319/"/>
    <id>http://enjoyhot.github.io/2015/03/19/study-thinking-20150319/</id>
    <published>2015-03-19T05:42:00.000Z</published>
    <updated>2016-07-16T06:35:11.722Z</updated>
    
    <content type="html">&lt;h1 id=&quot;社会篇&quot;&gt;&lt;a href=&quot;#社会篇&quot; class=&quot;headerlink&quot; title=&quot;社会篇&quot;&gt;&lt;/a&gt;社会篇&lt;/h1&gt;&lt;p&gt;   走过2014，看得很多是互联网如何在颠覆各个行业。以下说的都是感悟，可能有些无序，多多包含。&lt;/p&gt;
&lt;p&gt;   无论是做科研也好，投入社会工作也罢，在做以互联网技术为核心的技术学习时，都要有一个目标，做出为社会认可的有价值的“产品”，并间接体现为金钱财富。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;   
&lt;p&gt;   其实，互联网从访问互联网的用户中赚钱，流量即是渠道。曾听过一句话——“有流量就能赚钱”。确实，在各个行业环环相扣的时候，利用“代理”的作用能把流量转化为金钱，也由于这个原因，才使那么多网民孜孜不倦地以合法或不合法的手段游走于因特网各个角落。&lt;/p&gt;
&lt;p&gt;   然而，怎样最高效率地利用流量，叫要看个人的素养，假如我们将单纯上网的网民比作现实中普通的消费者，那么单纯利用流量赚钱可以比作打工者，而管理某个访问点的可以比作房东，那么房地产，设计师又如何？那需要有强大编程功底的各个阶层的创作者来担任了。从做服务，到做标准，互联网是另一个世界，虚拟而却又像现实生活中那样分工明确，生活着。&lt;/p&gt;
&lt;p&gt;   在这里，我相信都想往高处走，做创作者。但这里我有个发现，能做到标准的少之又少，多数成功者，走的却是先往高处走，当走到一定规模后，市场足够大，再往低处走，做稳定发展的打算。之后有余力再在高处不断试探，不断阶梯式上升，建造更高的高峰。&lt;/p&gt;
&lt;p&gt;   14年相比13年又可以称为互联网的爆炸阶段，不管是从从业的数量来看还是从创业的数量来看。一切的发展归根到底都是为了服务人类生活，往更便捷更智能更廉价发展。&lt;/p&gt;
&lt;p&gt;   因此，才涌现了更方便的产品，更智能的算法，更高速的计算。&lt;/p&gt;
&lt;p&gt;   #热点篇&lt;/p&gt;
&lt;p&gt;   更方便的产品，更智能的算法，更高速的计算，既是相对分开，却又是一脉相承，任何一个领域都可以颠覆另一个领域，当然，最终体现在产品上， 因而产品领域是最活跃的，门槛相对低的情况下又与金钱结合得最为紧密。而超算方面一直以来都比较冷门，毕竟门槛高，又与硬件运算最为相关&lt;/p&gt;
&lt;p&gt;   说到产品，苹果、谷歌、Facebook，产品之王|搜索之王|社交之王。&lt;/p&gt;
&lt;p&gt;   说到算法，目前人工智能领域的机器学习，深度学习，还有相关的大数据，云计算等。&lt;/p&gt;
&lt;p&gt;   说到计算，那就是超算，高性能计算，单台配上GPU和MIC可以提升计算能力，或者直接在集群上并行。&lt;/p&gt;
&lt;p&gt;   这三种内容在以后的博客应该都会多多少少体现。&lt;/p&gt;
&lt;p&gt;   #学习篇&lt;/p&gt;
&lt;p&gt;   慢慢啃，从实验到产品，是一个漫长的过程，但所有的收获，都是从test开始的，或许从产品着手不需要多高的理论积累，在这个风口也完全有可能飞得老高，所以才一家家公司冒出来，或者一些资深程序员直接跳出来创业。说实在，最后能将厚积理论勃发在产品的，互联网大公司才做得最好，毕竟资金人力都全了。小公司或者突然强势冒出来，大有盖过大公司风头之势，但大多昙花一现、干不过大公司，最后被收购也不是少例。虽说这样足够混迹互联网圈，但能主导一个潮流，不算是人生的一大乐事吗？&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;社会篇&quot;&gt;&lt;a href=&quot;#社会篇&quot; class=&quot;headerlink&quot; title=&quot;社会篇&quot;&gt;&lt;/a&gt;社会篇&lt;/h1&gt;&lt;p&gt;   走过2014，看得很多是互联网如何在颠覆各个行业。以下说的都是感悟，可能有些无序，多多包含。&lt;/p&gt;
&lt;p&gt;   无论是做科研也好，投入社会工作也罢，在做以互联网技术为核心的技术学习时，都要有一个目标，做出为社会认可的有价值的“产品”，并间接体现为金钱财富。&lt;/p&gt;
    
    </summary>
    
      <category term="life" scheme="http://enjoyhot.github.io/categories/life/"/>
    
    
      <category term="life" scheme="http://enjoyhot.github.io/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>【machine learning】KNN算法        </title>
    <link href="http://enjoyhot.github.io/2015/02/25/machinelearning-KNN/"/>
    <id>http://enjoyhot.github.io/2015/02/25/machinelearning-KNN/</id>
    <published>2015-02-25T08:04:00.000Z</published>
    <updated>2016-07-16T06:35:11.702Z</updated>
    
    <content type="html">&lt;p&gt;适逢学习机器学习基础知识，就将书中内容读读记记，本博文代码参考书本Machine Learning in Action（《机器学习实战》）。&lt;/p&gt;
&lt;h1 id=&quot;一、概述&quot;&gt;&lt;a href=&quot;#一、概述&quot; class=&quot;headerlink&quot; title=&quot;一、概述&quot;&gt;&lt;/a&gt;一、概述&lt;/h1&gt;&lt;p&gt;kNN算法又称为k近邻分类(k-nearest neighbor classification)算法。&lt;/p&gt;
&lt;p&gt;kNN算法则是从训练集中找到和新数据最接近的k条记录，然后根据他们的主要分类来决定新数据的类别。该算法涉及3个主要因素：训练集、距离或相似的衡量、k的大小。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;二、算法要点&quot;&gt;&lt;a href=&quot;#二、算法要点&quot; class=&quot;headerlink&quot; title=&quot;二、算法要点&quot;&gt;&lt;/a&gt;二、算法要点&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;1、指导思想&lt;/strong&gt;&lt;br&gt;kNN算法的指导思想是“近朱者赤，近墨者黑”，由你的邻居来推断出你的类别。&lt;/p&gt;
&lt;p&gt;计算步骤如下：&lt;br&gt;1）算距离：给定测试对象，计算它与训练集中的每个对象的距离&lt;br&gt;2）找邻居：圈定距离最近的k个训练对象，作为测试对象的近邻&lt;br&gt;3）做分类：根据这k个近邻归属的主要类别，来对测试对象分类&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2、距离或相似度的衡量&lt;/strong&gt;&lt;br&gt;什么是合适的距离衡量？距离越近应该意味着这两个点属于一个分类的可能性越大。&lt;br&gt;距离衡量包括欧式距离、夹角余弦等。&lt;br&gt;对于文本分类来说，使用余弦(cosine)来计算相似度就比欧式(Euclidean)距离更合适。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3、类别的判定&lt;/strong&gt;&lt;br&gt;投票决定：少数服从多数，近邻中哪个类别的点最多就分为该类，属于以频率为标准。&lt;br&gt;加权投票法：根据距离的远近，对近邻的投票进行加权，距离越近则权重越大（权重为距离平方的倒数），属于以量化为标准。&lt;/p&gt;
&lt;h1 id=&quot;三、优缺点&quot;&gt;&lt;a href=&quot;#三、优缺点&quot; class=&quot;headerlink&quot; title=&quot;三、优缺点&quot;&gt;&lt;/a&gt;三、优缺点&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;1、优点&lt;/strong&gt;&lt;br&gt;简单，易于理解，易于实现，无需估计参数，无需训练&lt;br&gt;适合对稀有事件进行分类（例如当流失率很低时，比如低于0.5%，构造流失预测模型）&lt;br&gt;特别适合于多分类问题(multi-modal,对象具有多个类别标签)，例如根据基因特征来判断其功能分类，kNN比SVM的表现要好&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2、缺点&lt;/strong&gt;&lt;br&gt;懒惰算法，对测试样本分类时的计算量大，内存开销大，评分慢&lt;br&gt;可解释性较差，无法给出决策树那样的规则。&lt;/p&gt;
&lt;h1 id=&quot;四、利用KNN进行手写识别&quot;&gt;&lt;a href=&quot;#四、利用KNN进行手写识别&quot; class=&quot;headerlink&quot; title=&quot;四、利用KNN进行手写识别&quot;&gt;&lt;/a&gt;四、利用KNN进行手写识别&lt;/h1&gt;&lt;p&gt;假如存在训练数据，都是二值得灰度图，来源于手写面板的采集图像数据。如下表示数字‘0’，所在文件夹下包括表示0~9的文件，文件夹命名A_B.txt,A表示真实数字，B表示该数字的第B个样本（一般数据越多有有利于接近预测值）&lt;/p&gt;
&lt;p&gt;   &lt;img src=&quot;http://img.blog.csdn.net/20150225162324294?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt; 在另一个文件夹中，也存在同样命名的数据文件，用于检验有监督学习下的准确率，我们称为测试数据。&lt;br&gt;在代码中，我们需要三个函数&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;def classify0(inX, dataSet, labels, k)——用于对输入单个样本inX进行分类，dataSet为训练数据，labels为训练数据的类别，K为近邻范围&lt;br&gt;def img2vector(filename)——将文件filename中的数据规格由32X32转换为1X1024的向量&lt;br&gt;def handwritingClassTest()——利用测试数据进行测试，得出错误率&lt;br&gt;我这里只用了0~9分别20个训练数据而已，提高速度。需要源代码可以到机器学习实战的配套代码中取&lt;br&gt;  &lt;a href=&quot;http://vdisk.weibo.com/s/uEZesAafcjQgx?sudaref=www.baidu.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://vdisk.weibo.com/s/uEZesAafcjQgx?sudaref=www.baidu.com&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;代码中用到了numpy库，numpy库用在数据量大的计算较高效&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;numpy用法小抄：&lt;/strong&gt;&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;tile([&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;], (&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;array([[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;tile([&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;], (&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;array([[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       [&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;`&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;第一个是矩阵A&lt;br&gt;第二个参数是要 只有一个数字时，表示 对 A中元素重复的次数&lt;br&gt;两个参数时（x， y） y表示对A中元素重复的次数， x表示 对前面的操作执行x次。&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;b= np.arange(&lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;).reshape(&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;b&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;array([[ &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;           [ &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;           [ &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;]])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;b.sum(axis=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;comment&quot;&gt;# 计算每一列的和，注意理解轴的含义，参考数组的第一篇文章&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;array([&lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;15&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;18&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;21&lt;/span&gt;])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;b.min(axis=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;comment&quot;&gt;# 获取每一行的最小值&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;array([&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;b.cumsum(axis=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;comment&quot;&gt;# 计算每一行的累积和&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;array([[ &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;           [ &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;15&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;22&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;           [ &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;17&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;27&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;38&lt;/span&gt;]])&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;需要用到再另外写博客进行补充。&lt;br&gt;KNN.py&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#! /usr/bin/env python&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#coding=utf-8&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; numpy &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; *&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; operator&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; os &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; listdir&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;classify0&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(inX, dataSet, labels, k)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#inX------[x,x,x,x]&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#dataSet------array([[x,x,x,x],[x,x,x,x]])&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#labels------[x,x]&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#k------n&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    dataSetSize = dataSet.shape[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    diffMat = tile(inX, (dataSetSize,&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)) - dataSet&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    sqDiffMat = diffMat**&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    sqDistances = sqDiffMat.sum(axis=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    distances = sqDistances**&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    sortedDistIndicies = distances.argsort()     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    classCount=&amp;#123;&amp;#125;          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; range(k):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        voteIlabel = labels[sortedDistIndicies[i]]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        classCount[voteIlabel] = classCount.get(voteIlabel,&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#将字典按value值大小降序排序,结果为二维列表&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    sortedClassCount = sorted(classCount.iteritems(), key=operator.itemgetter(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;), reverse=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; sortedClassCount[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;][&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;img2vector&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(filename)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    returnVect = zeros((&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    fr = open(filename,&lt;span class=&quot;string&quot;&gt;&#39;r&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; range(&lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        lineStr = fr.readline()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; j &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; range(&lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            returnVect[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;*i+j] = int(lineStr[j])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; returnVect&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;trainFile = &lt;span class=&quot;string&quot;&gt;&#39;F:\\python\\pyproject\\ML\\codes\\machinelearninginaction\\Ch02\\training20\\&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;testFile = &lt;span class=&quot;string&quot;&gt;&#39;F:\\python\\pyproject\\ML\\codes\\machinelearninginaction\\Ch02\\testDigits\\&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;handwritingClassTest&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    hwLabels = []&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    trainingFileList = listdir(trainFile)           &lt;span class=&quot;comment&quot;&gt;#load the training set&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    m = len(trainingFileList)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    trainingMat = zeros((m,&lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; range(m):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        fileNameStr = trainingFileList[i]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        fileStr = fileNameStr.split(&lt;span class=&quot;string&quot;&gt;&#39;.&#39;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]     &lt;span class=&quot;comment&quot;&gt;#take off .txt&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        classNumStr = int(fileStr.split(&lt;span class=&quot;string&quot;&gt;&#39;_&#39;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        hwLabels.append(classNumStr)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        path = trainFile + &lt;span class=&quot;string&quot;&gt;&#39;%s&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        trainingMat[i,:] = img2vector(path % fileNameStr)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    testFileList = listdir(testFile)        &lt;span class=&quot;comment&quot;&gt;#iterate through the test set&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    errorCount = &lt;span class=&quot;number&quot;&gt;0.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    mTest = len(testFileList)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; range(mTest):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        fileNameStr = testFileList[i]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        fileStr = fileNameStr.split(&lt;span class=&quot;string&quot;&gt;&#39;.&#39;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]     &lt;span class=&quot;comment&quot;&gt;#take off .txt&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        classNumStr = int(fileStr.split(&lt;span class=&quot;string&quot;&gt;&#39;_&#39;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        path = testFile + &lt;span class=&quot;string&quot;&gt;&#39;%s&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        vectorUnderTest = img2vector(path % fileNameStr)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        classifierResult = classify0(vectorUnderTest, trainingMat, hwLabels, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;the classifier came back with: %d, the real answer is: %d&quot;&lt;/span&gt; % (classifierResult, classNumStr)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (classifierResult != classNumStr): errorCount += &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;\nthe total number of errors is: %d&quot;&lt;/span&gt; % errorCount&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;\nthe total error rate is: %f&quot;&lt;/span&gt; % (errorCount/float(mTest))&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; 再在test.py中调用KNN.handwritingClassTest()，则程序开始运行&lt;/p&gt;
&lt;p&gt;  test.py&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#! /usr/bin/env python&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#coding=utf-8&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; KNN&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;KNN.handwritingClassTest()&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; 可看到错误率10.68%，挺高的，增加训练数据量就应该会减小一些。&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150225165135118?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;适逢学习机器学习基础知识，就将书中内容读读记记，本博文代码参考书本Machine Learning in Action（《机器学习实战》）。&lt;/p&gt;
&lt;h1 id=&quot;一、概述&quot;&gt;&lt;a href=&quot;#一、概述&quot; class=&quot;headerlink&quot; title=&quot;一、概述&quot;&gt;&lt;/a&gt;一、概述&lt;/h1&gt;&lt;p&gt;kNN算法又称为k近邻分类(k-nearest neighbor classification)算法。&lt;/p&gt;
&lt;p&gt;kNN算法则是从训练集中找到和新数据最接近的k条记录，然后根据他们的主要分类来决定新数据的类别。该算法涉及3个主要因素：训练集、距离或相似的衡量、k的大小。&lt;br&gt;
    
    </summary>
    
      <category term="Machine Learning" scheme="http://enjoyhot.github.io/categories/Machine-Learning/"/>
    
    
      <category term="ML foundation" scheme="http://enjoyhot.github.io/tags/ML-foundation/"/>
    
      <category term="classifier" scheme="http://enjoyhot.github.io/tags/classifier/"/>
    
  </entry>
  
  <entry>
    <title>网络爬虫框架scrapy介绍及应用——抓取新浪新闻的标题内容评论        </title>
    <link href="http://enjoyhot.github.io/2015/01/21/python-scrapy/"/>
    <id>http://enjoyhot.github.io/2015/01/21/python-scrapy/</id>
    <published>2015-01-21T07:12:00.000Z</published>
    <updated>2016-07-16T06:35:11.718Z</updated>
    
    <content type="html">&lt;h1 id=&quot;一、综述&quot;&gt;&lt;a href=&quot;#一、综述&quot; class=&quot;headerlink&quot; title=&quot;一、综述&quot;&gt;&lt;/a&gt;一、综述&lt;/h1&gt;&lt;p&gt;  开始这篇博文之前，调研了相关的爬虫方法，简单罗列冰山一角。&lt;/p&gt;
&lt;p&gt;  综述：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.crifan.com/summary_about_flow_process_of_fetch_webpage_simulate_login_website_and_some_notice/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.crifan.com/summary_about_flow_process_of_fetch_webpage_simulate_login_website_and_some_notice/&lt;/a&gt;&lt;/p&gt;
 &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;  手动编写爬虫，httpclient是常用工具。常见的请求方式有httpget和httppost&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.csdn.net/mr_tank_/article/details/17454315&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/mr_tank_/article/details/17454315&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.csdn.net/chszs/article/details/16854747&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/chszs/article/details/16854747&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.yeetrack.com/?p=779&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.yeetrack.com/?p=779&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;  这个教程很全面。供参考和备查&lt;/p&gt;
&lt;p&gt;  htmlunit&lt;/p&gt;
&lt;p&gt;  httpclient 对js 的支持比较差，有时候需要使用htmlunit 或者selenium。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.360doc.com/content/13/1229/14/14875906_340995211.shtml&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.360doc.com/content/13/1229/14/14875906_340995211.shtml&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.csdn.net/strawbingo/article/details/5768421&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/strawbingo/article/details/5768421&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cnblogs.com/microsoftmvp/p/3716750.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.cnblogs.com/microsoftmvp/p/3716750.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt; 抽取相关&lt;br&gt;当爬取了html 后，需要去除噪声广告，抽取有用的信息。jsoup 和tika 是非常强大的工具&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://jsoup.org/cookbook/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://jsoup.org/cookbook/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://summerbell.iteye.com/blog/565922&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://summerbell.iteye.com/blog/565922&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;  github开源爬虫库&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/CrawlScript/WebCollector&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/CrawlScript/WebCollector&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/zhuoran/crawler4j&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/zhuoran/crawler4j&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;  开源爬虫框架nutch&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cnblogs.com/xuekyo/archive/2013/04/18/3028559.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.cnblogs.com/xuekyo/archive/2013/04/18/3028559.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://ahei.info/nutch-tutorial.htm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://ahei.info/nutch-tutorial.htm&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://lc87624.iteye.com/blog/1625677&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://lc87624.iteye.com/blog/1625677&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;  由于要学习python语言，就关注了python爬虫的方法，scrapy框架是个成熟的开源爬虫框架，因此选择其作为学习内容。&lt;br&gt;Scrapy是一个基于Twisted，纯Python实现的爬虫框架，用户只需要定制开发几个模块就可以轻松的实现一个爬虫，用来抓取网页内容、图片、视频等，非常方便。&lt;/p&gt;
&lt;h1 id=&quot;二、scrapy框架&quot;&gt;&lt;a href=&quot;#二、scrapy框架&quot; class=&quot;headerlink&quot; title=&quot;二、scrapy框架&quot;&gt;&lt;/a&gt;二、scrapy框架&lt;/h1&gt;&lt;h2 id=&quot;1、整体架构如下：&quot;&gt;&lt;a href=&quot;#1、整体架构如下：&quot; class=&quot;headerlink&quot; title=&quot;1、整体架构如下：&quot;&gt;&lt;/a&gt;1、整体架构如下：&lt;/h2&gt;&lt;p&gt;   &lt;img src=&quot;http://img.blog.csdn.net/20150121152425667?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt; 绿线是数据流向，首先从初始URL 开始，Scheduler 会将其交给 Downloader 进行下载，下载之后会交给 Spider 进行分析，Spider分析出来的结果有两种：一种是需要进一步抓取的链接，&lt;/p&gt;
&lt;p&gt;例如之前分析的“下一页”的链接，这些东西会被传回 Scheduler ；另一种是需要保存的数据，它们则被送到Item Pipeline 那里，那是对数据进行后期处理（详细分析、过滤、存储等）的&lt;/p&gt;
&lt;p&gt;地方。另外，在数据流动的通道里还可以安装各种中间件，进行必要的处理。参考&lt;a href=&quot;http://blog.csdn.net/HanTangSongMing/article/details/24454453&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;br&gt;    博客
   &lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;2、工程文件介绍&quot;&gt;&lt;a href=&quot;#2、工程文件介绍&quot; class=&quot;headerlink&quot; title=&quot;2、工程文件介绍&quot;&gt;&lt;/a&gt;2、工程文件介绍&lt;/h2&gt;&lt;p&gt;假设你已经配置好环境了，进入某个文件夹pythonproject，在命令行中输入&lt;br&gt;scrapy startproject mypro&lt;br&gt;即可在pythonporoject文件夹下找到mypro的工程文件夹，结构如下：&lt;/p&gt;
&lt;p&gt;├── mypro&lt;br&gt;│   ├── mypro&lt;br&gt;│   │   ├── &lt;strong&gt;init&lt;/strong&gt;.py&lt;br&gt;│   │   ├── items.py&lt;br&gt;│   │   ├── pipelines.py&lt;br&gt;│   │   ├── settings.py&lt;br&gt;│   │   └── spiders&lt;br&gt;│   │      └── &lt;strong&gt;init&lt;/strong&gt;.py&lt;br&gt;│   └── scrapy.cfg&lt;/p&gt;
&lt;p&gt;scrapy.cfg: 项目配置文件&lt;br&gt;items.py: 需要提取的数据结构定义文件&lt;br&gt;pipelines.py:管道定义，用来对items里面提取的数据做进一步处理，如保存等&lt;br&gt;settings.py: 爬虫配置文件&lt;/p&gt;
&lt;p&gt;Items是将要装载抓取的数据的容器，它工作方式像python里面的字典，但它提供更多的保护，比如对未定义的字段填充以防止拼写错误。它通过创建一个scrapy.item.Item类来声明&lt;br&gt;，定义它的属性为scrpiy.item.Field对象，就像是一个对象关系映射(ORM)，我们通过将需要的item模型化，来控制从dmoz.org获得的站点数据。虽然这次的实现并没有用到items.py和&lt;/p&gt;
&lt;p&gt;pipelines.py，但大规模的爬虫还是需要注意一下解耦。&lt;br&gt;举个例子：&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; scrapy.item &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; Item, Field    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DmozItem&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Item)&lt;/span&gt;:&lt;/span&gt;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    title = Field()   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    link = Field()   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    desc = Field()&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; 在修改初始化代码时，首先需要在pythonproject//mypro//mypro//spiders下新建一个python文件，原则上所有的实现可以在这个文件里完成，当然耦合度就高了。在这个文件中，你需要新&lt;/p&gt;
&lt;p&gt;建一个类，这个类需要添加以下属性：&lt;br&gt;1、该类继承于某个spider类，根据自己的需求，有很多可以选，如crawSpider，BaseSpider，Spider，XMLFeedSpider，CSVFeedSpider，SitemapSpider等等&lt;br&gt;2、name：爬虫的识别名，它必须是唯一的，在不同的爬虫中你必须定义不同的名字，例如下文的”yourname”&lt;br&gt;3、start_urls：爬虫开始爬的一个URL列表。爬虫从这里开始抓取数据，所以，第一次下载的数据将会从这些URLS开始。其他子URL将会从这些起始URL中继承性生成。&lt;br&gt;4、parse()：爬虫的方法，调用时候传入从每一个URL传回的Response对象作为参数，response将会是parse方法的唯一的一个参数，这个方法负责解析返回的数据、匹配抓取的数据(解析为&lt;/p&gt;
&lt;p&gt;item)并跟踪更多的URL。返回前可以巧妙地运用yield方法递归调用网址，此关键词的作用是返回某个对象后继续执行。如果不用该关键字，则直接会在函数中返回。&lt;/p&gt;
&lt;p&gt;一般而言，运用scrapy的步骤是这样的：&lt;br&gt;1、在pythonproject//mypro//mypro//spiders下新建一个python文件&lt;br&gt;2、导入该导入的库文件，新建一个类满足以上要求。&lt;br&gt;3、根据继承的类的要求和功能，定义爬取规则。&lt;br&gt;4、在def parse(self, response)函数中对response对象解析，将需要的内容存入item对象并返回，在这里对数据不返回而是进行进一步处理也是可以的，耦合度高。&lt;br&gt;5、PipeLine用来对Spider返回的Item列表进行保存操作，可以写入到文件、或者数据库等。PipeLine只有一个需要实现的方法：process_item。&lt;br&gt;万事具备之后，通过命令行进入pythonproject//mypro文件夹中，敲下命令行开始爬虫&lt;br&gt;scrapy crawl “yourname”&lt;br&gt;scrapy命令罗列几个，要更多请参看&lt;a href=&quot;http://scrapy-chs.readthedocs.org/zh_CN/0.24/topics/commands.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;doc&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;scrapy startproject xxx&lt;/code&gt; 新建一个xxx的project&lt;/li&gt;
&lt;li&gt;&lt;code&gt;scrapy crawl xxx&lt;/code&gt; 开始爬取，必须在project中&lt;/li&gt;
&lt;li&gt;&lt;code&gt;scrapy shell url&lt;/code&gt; 在scrapy的shell中打开url，非常实用&lt;/li&gt;
&lt;li&gt;&lt;code&gt;scrapy runspider &amp;lt;spider_file.py&amp;gt;&lt;/code&gt; 可以在没有project的情况下运行爬虫&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;三、新浪新闻爬虫&quot;&gt;&lt;a href=&quot;#三、新浪新闻爬虫&quot; class=&quot;headerlink&quot; title=&quot;三、新浪新闻爬虫&quot;&gt;&lt;/a&gt;三、新浪新闻爬虫&lt;/h1&gt;&lt;p&gt;众所周知，评论一般是隐藏起来的，或者显示部分，需要手动点击加载去获取更多评论。有两种方法可以解决这种方法，一种是利用js动态解析，工作量大，也比较难实现，二是直接定位到其查询数据库的url，直接抽取。下文就是讲第二种方法。&lt;br&gt;新浪页面导航为我们简单分好类了&lt;a href=&quot;http://news.sina.com.cn/guide/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://news.sina.com.cn/guide/&lt;/a&gt;，而且每个类别中都可以找到相应的滚动新闻（url冠以roll），因而没必要用到crawSpider这个类，这个类功能很强大，不仅可以自动去重，还可以定义更多的爬取规则。例如这个链接&lt;a href=&quot;http://roll.finance.sina.com.cn/finance/zq1/index_1.shtml&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://roll.finance.sina.com.cn/finance/zq1/index_1.shtml&lt;/a&gt;，通过修改数字可以实现不断爬取对于新闻的url，当然没有这么“好”的url也是可以找到新闻的url。例如：&lt;a href=&quot;http://sports.sina.com.cn/nba/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://sports.sina.com.cn/nba/&lt;/a&gt;&lt;br&gt;可以调用的浏览器的开发工具查找对应的js代码，查看数据库的url，之后在查看评论的时候也是这样的方法（点击刷新即可）&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150121163439093?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150121163529857?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt; 访问这个&lt;a href=&quot;http://feed.mix.sina.com.cn/api/roll/tags?channelid=6&amp;amp;sq=x_where:digit_cl==399872&amp;amp;begin=1401552000&amp;amp;tags=%E6%B9%96%E4%BA%BA%2C%E9%AA%91%E5%A3%AB%2C%E7%81%AB%E7%AE%AD%2C%E8%A9%B9%E5%A7%86%E6%96%AF%2C%E7%A7%91%E6%AF%94&amp;amp;num=30&amp;amp;lid=-3000&amp;amp;versionNumber=1.2.4&amp;amp;page=4&amp;amp;encode=utf-8&amp;amp;callback=feedCardJsonpCallback&amp;amp;_=1421828921159&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;链接&lt;/a&gt;可以查看url&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150121163516500?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;   因此，访问这个&lt;a href=&quot;http://roll.finance.sina.com.cn/finance/zq1/index_1.shtml&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;链接&lt;/a&gt;的内容，爬取新闻url,访问新闻并爬取标题、内容、评论。&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;67&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;68&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;69&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;70&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;71&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;72&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;73&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;74&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;75&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;76&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;77&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;78&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;79&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;80&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;81&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;82&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;83&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;84&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;85&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;86&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;87&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;88&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;89&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;90&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;91&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;92&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;93&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;94&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;95&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;96&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;97&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;98&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;99&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;100&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;101&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;102&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;103&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;104&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;105&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;106&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;107&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;108&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;109&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;110&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;111&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;112&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;113&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;114&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;115&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;116&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;117&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;118&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;119&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;120&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;121&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;122&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;123&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;124&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;125&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;126&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;127&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;128&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;129&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;130&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;131&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;132&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;133&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;134&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;135&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;136&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;137&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;138&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;139&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;140&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;141&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;142&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;143&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;144&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;145&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;146&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;147&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;148&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;149&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;150&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;151&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;152&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;153&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;154&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;155&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;156&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;157&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;158&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;159&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;160&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;161&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;162&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;163&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;164&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;165&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;166&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;167&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;168&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;169&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;170&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;171&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;172&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;173&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;174&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;175&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;176&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;177&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;178&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;179&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;180&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;181&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;182&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;183&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;184&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;185&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;186&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;187&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;188&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;189&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;190&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;191&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;192&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;193&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;194&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;195&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;196&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;197&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;198&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;199&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;200&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;201&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;202&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;203&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;204&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;205&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;206&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;207&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;208&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;209&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;210&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;211&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;212&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;213&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;214&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;215&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;216&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;217&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;218&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;219&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;220&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;221&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;222&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#! /usr/bin/env python  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#coding=utf-8  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; scrapy.selector &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; Selector  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; scrapy.http &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; Request  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; re,os  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; bs4 &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; BeautifulSoup  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; scrapy.spider &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; Spider  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; urllib2,thread  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#处理编码问题  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; sys  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;reload(sys)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sys.setdefaultencoding(&lt;span class=&quot;string&quot;&gt;&#39;gb18030&#39;&lt;/span&gt;)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#flag的作用是保证第一次爬取的时候不进行单个新闻页面内容的爬取  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;flag=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;projectpath=&lt;span class=&quot;string&quot;&gt;&#39;F:\\Python27\\pythonproject\\fuck\\&#39;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(*response)&lt;/span&gt;:&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sel = Selector(response[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;])   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#get title           &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        title = sel.xpath(&lt;span class=&quot;string&quot;&gt;&#39;//h1/text()&#39;&lt;/span&gt;).extract()  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#get pages  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        pages=sel.xpath(&lt;span class=&quot;string&quot;&gt;&#39;//div[@id=&quot;artibody&quot;]//p/text()&#39;&lt;/span&gt;).extract()  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#get chanel_id &amp;amp; comment_id  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        s=sel.xpath(&lt;span class=&quot;string&quot;&gt;&#39;//meta[@name=&quot;comment&quot;]&#39;&lt;/span&gt;).extract()                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;              &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#comment_id = channel[index+3:index+15]  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        index2=len(response[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;].url)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        news_id=response[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;].url[index2&lt;span class=&quot;number&quot;&gt;-14&lt;/span&gt;:index2&lt;span class=&quot;number&quot;&gt;-6&lt;/span&gt;]  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        comment_id=&lt;span class=&quot;string&quot;&gt;&#39;31-1-&#39;&lt;/span&gt;+news_id      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#评论内容都在这个list中  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        cmntlist=[]  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        page=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#含有新闻url,标题,内容,评论的文件  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        file2=&lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#该变量的作用是当某新闻下存在非手机用户评论时置为False  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        is_all_tel=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;((page==&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;or&lt;/span&gt; (cmntlist != [])):  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;              &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            tel_count=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;#each page tel_user_count  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;#提取到的评论url  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            url=&lt;span class=&quot;string&quot;&gt;&quot;http://comment5.news.sina.com.cn/page/info?version=1&amp;amp;format=js&amp;amp;channel=cj&amp;amp;newsid=&quot;&lt;/span&gt;+str(comment_id)+&lt;span class=&quot;string&quot;&gt;&quot;&amp;amp;group=0&amp;amp;compress=1&amp;amp;ie=gbk&amp;amp;oe=gbk&amp;amp;page=&quot;&lt;/span&gt;+str&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;(page)+&lt;span class=&quot;string&quot;&gt;&quot;&amp;amp;page_size=100&quot;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            url_contain=urllib2.urlopen(url).read()  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            b=&lt;span class=&quot;string&quot;&gt;&#39;=&amp;#123;&#39;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            after = url_contain[url_contain.index(b)+len(b)&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;:]  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;#字符串中的None对应python中的null，不然执行eval时会出错  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            after=after.replace(&lt;span class=&quot;string&quot;&gt;&#39;null&#39;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;None&#39;&lt;/span&gt;)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;#转换为字典变量text  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            text=eval(after)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;              &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;cmntlist&#39;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; text[&lt;span class=&quot;string&quot;&gt;&#39;result&#39;&lt;/span&gt;]:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                cmntlist=text[&lt;span class=&quot;string&quot;&gt;&#39;result&#39;&lt;/span&gt;][&lt;span class=&quot;string&quot;&gt;&#39;cmntlist&#39;&lt;/span&gt;]  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                cmntlist=[]                          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;              &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;              &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; cmntlist != [] &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; (page==&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;):  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                filename=str(comment_id)+&lt;span class=&quot;string&quot;&gt;&#39;.txt&#39;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                path=projectpath+&lt;span class=&quot;string&quot;&gt;&#39;stock\\&#39;&lt;/span&gt; +filename  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                file2=open(path,&lt;span class=&quot;string&quot;&gt;&#39;a+&#39;&lt;/span&gt;)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                news_content=str(&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; p &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; pages:                                                              &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    news_content=news_content+p+&lt;span class=&quot;string&quot;&gt;&#39;\n&#39;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                item=&lt;span class=&quot;string&quot;&gt;&quot;&amp;lt;url&amp;gt;&quot;&lt;/span&gt;+response[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;].url+&lt;span class=&quot;string&quot;&gt;&quot;&amp;lt;/url&amp;gt;&quot;&lt;/span&gt;+&lt;span class=&quot;string&quot;&gt;&#39;\n\n&#39;&lt;/span&gt;+&lt;span class=&quot;string&quot;&gt;&quot;&amp;lt;title&amp;gt;&quot;&lt;/span&gt;+str(title[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;])+&lt;span class=&quot;string&quot;&gt;&quot;&amp;lt;/title&amp;gt;\n\n&quot;&lt;/span&gt;+&lt;span class=&quot;string&quot;&gt;&quot;&amp;lt;content&amp;gt;\n&quot;&lt;/span&gt;+str(news_content)+&lt;span class=&quot;string&quot;&gt;&quot;&amp;lt;/content&amp;gt;\n\n&amp;lt;comment&amp;gt;\n&quot;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                file2.write(item)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; cmntlist != []:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                content=&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; status_dic &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; cmntlist:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; status_dic[&lt;span class=&quot;string&quot;&gt;&#39;uid&#39;&lt;/span&gt;]!=&lt;span class=&quot;string&quot;&gt;&#39;0&#39;&lt;/span&gt;:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        is_all_tel=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;comment&quot;&gt;#这一句视编码情况而定，在这里去掉decode和encode也行  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        s=status_dic[&lt;span class=&quot;string&quot;&gt;&#39;content&#39;&lt;/span&gt;].decode(&lt;span class=&quot;string&quot;&gt;&#39;UTF-8&#39;&lt;/span&gt;).encode(&lt;span class=&quot;string&quot;&gt;&#39;GBK&#39;&lt;/span&gt;)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;comment&quot;&gt;#见另一篇博客“三张图”  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        s=s.replace(&lt;span class=&quot;string&quot;&gt;&quot;&#39;&quot;&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&quot;&#39;&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;&quot;&#39;&lt;/span&gt;) &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        s=s.replace(&lt;span class=&quot;string&quot;&gt;&quot;\n&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;) &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        s1=&lt;span class=&quot;string&quot;&gt;&quot;u&#39;&quot;&lt;/span&gt;+s+&lt;span class=&quot;string&quot;&gt;&quot;&#39;&quot;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt;:                          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            ss=eval(s1)                   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;except&lt;/span&gt;:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt;:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                s1=&lt;span class=&quot;string&quot;&gt;&#39;u&quot;&#39;&lt;/span&gt;+s+&lt;span class=&quot;string&quot;&gt;&#39;&quot;&#39;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                ss=eval(s1)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            &lt;span class=&quot;keyword&quot;&gt;except&lt;/span&gt;:                            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        content=content+status_dic[&lt;span class=&quot;string&quot;&gt;&#39;time&#39;&lt;/span&gt;]+&lt;span class=&quot;string&quot;&gt;&#39;\t&#39;&lt;/span&gt;+status_dic[&lt;span class=&quot;string&quot;&gt;&#39;uid&#39;&lt;/span&gt;]+&lt;span class=&quot;string&quot;&gt;&#39;\t&#39;&lt;/span&gt;+ss+&lt;span class=&quot;string&quot;&gt;&#39;\n&#39;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;comment&quot;&gt;#当属于手机用户时  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        tel_count=tel_count+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                       &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;#当一个page下不都是手机用户时，这里也可以用is_all_tel进行判断，一种是用开关的方式，一种是统计的方式  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;#算了不改了  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; tel_count!=len(cmntlist):  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    file2.write(content)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            page=page+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;              &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;              &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#while loop end here  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; file2!=&lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;#当都是手机用户时，移除文件，否则写入&quot;&amp;lt;/comment&amp;gt;&quot;到文件尾           &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; is_all_tel:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                file2.close()  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt;:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    os.remove(file2.name)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;except&lt;/span&gt; WindowsError:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;pass&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                file2.write(&lt;span class=&quot;string&quot;&gt;&quot;&amp;lt;/comment&amp;gt;&quot;&lt;/span&gt;)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                file2.close()  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DmozSpider&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Spider)&lt;/span&gt;:&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    name = &lt;span class=&quot;string&quot;&gt;&quot;stock&quot;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    allowed_domains = [&lt;span class=&quot;string&quot;&gt;&quot;sina.com.cn&quot;&lt;/span&gt;]  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#在本程序中，start_urls并不重要，因为并没有解析  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    start_urls = [  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;http://news.sina.com.cn/&quot;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ]  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;global&lt;/span&gt; projectpath  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; os.path.exists(projectpath+&lt;span class=&quot;string&quot;&gt;&#39;stock&#39;&lt;/span&gt;):  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;pass&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        os.mkdir(projectpath+&lt;span class=&quot;string&quot;&gt;&#39;stock&#39;&lt;/span&gt;)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self, response)&lt;/span&gt;:&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#这个scrapy.selector.Selector是个不错的处理字符串的类，python对编码很严格，它却处理得很好  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#在做这个爬虫的时候，碰到很多奇奇怪怪的编码问题，主要是中文，试过很多既有的类，BeautifulSoup处理得也不是很好  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sel = Selector(response)            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;global&lt;/span&gt; flag  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                              &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(flag==&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;):  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            flag=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            page=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; page&amp;lt;&lt;span class=&quot;number&quot;&gt;260&lt;/span&gt;:   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                url=&lt;span class=&quot;string&quot;&gt;&quot;http://roll.finance.sina.com.cn/finance/zq1/index_&quot;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                url=url+str(page)+&lt;span class=&quot;string&quot;&gt;&quot;.shtml&quot;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;#伪装为浏览器  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                user_agent = &lt;span class=&quot;string&quot;&gt;&#39;Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)&#39;&lt;/span&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                headers = &amp;#123; &lt;span class=&quot;string&quot;&gt;&#39;User-Agent&#39;&lt;/span&gt; : user_agent &amp;#125;                    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                req = urllib2.Request(url, headers=headers)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                response = urllib2.urlopen(req)    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                url_contain = response.read()   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;#利用BeautifulSoup进行文档解析    &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                soup = BeautifulSoup(url_contain)                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                params = soup.findAll(&lt;span class=&quot;string&quot;&gt;&#39;div&#39;&lt;/span&gt;,&amp;#123;&lt;span class=&quot;string&quot;&gt;&#39;class&#39;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&#39;listBlk&#39;&lt;/span&gt;&amp;#125;)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; os.path.exists(projectpath+&lt;span class=&quot;string&quot;&gt;&#39;stock\\&#39;&lt;/span&gt;+&lt;span class=&quot;string&quot;&gt;&#39;link&#39;&lt;/span&gt;):  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                     &lt;span class=&quot;keyword&quot;&gt;pass&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                     os.mkdir(projectpath+&lt;span class=&quot;string&quot;&gt;&#39;stock\\&#39;&lt;/span&gt;+&lt;span class=&quot;string&quot;&gt;&#39;link&#39;&lt;/span&gt;)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                filename=&lt;span class=&quot;string&quot;&gt;&#39;link.txt&#39;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                path=projectpath+&lt;span class=&quot;string&quot;&gt;&#39;stock\\link\\&#39;&lt;/span&gt; + filename  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                filelink=open(path,&lt;span class=&quot;string&quot;&gt;&#39;a+&#39;&lt;/span&gt;)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; params_item &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; params:          &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    persons = params_item.findAll(&lt;span class=&quot;string&quot;&gt;&#39;li&#39;&lt;/span&gt;)                      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; item &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; persons:                      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        href=item.find(&lt;span class=&quot;string&quot;&gt;&#39;a&#39;&lt;/span&gt;)  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        mil_link= href.get(&lt;span class=&quot;string&quot;&gt;&#39;href&#39;&lt;/span&gt;)                                                     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        filelink.write(str(mil_link)+&lt;span class=&quot;string&quot;&gt;&#39;\n&#39;&lt;/span&gt;)                                                   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;comment&quot;&gt;#递归调用parse,传入新的爬取url  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; Request(mil_link, callback=self.parse)                                &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                page=page+&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;#对单个新闻页面新建线程进行爬取  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; flag!=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;:  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (response.status != &lt;span class=&quot;number&quot;&gt;404&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; (response.status != &lt;span class=&quot;number&quot;&gt;502&lt;/span&gt;):  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                thread.start_new_thread(loop,(response,))&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; 爬取结果：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150121171359378?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;在爬取的过程中要注意三点：&lt;br&gt;1.爬取不要过于频繁，不然可能会被封ip，可以减小爬取的速度，sleep一下，或者更改设置文件，我的在F:\Python27\python\Lib\site-packages\Scrapy-0.24.4-py2.7.egg\scrapy\settings\default_settings.py&lt;br&gt;2.文件夹的文件上限为21845，超过后注意再新建一个文件夹爬取&lt;br&gt;3.线程不能开得太多，不然也可能达到上限，可以考虑用代码现在所开线程的多少或者利用分布式系统&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;一、综述&quot;&gt;&lt;a href=&quot;#一、综述&quot; class=&quot;headerlink&quot; title=&quot;一、综述&quot;&gt;&lt;/a&gt;一、综述&lt;/h1&gt;&lt;p&gt;  开始这篇博文之前，调研了相关的爬虫方法，简单罗列冰山一角。&lt;/p&gt;
&lt;p&gt;  综述：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.crifan.com/summary_about_flow_process_of_fetch_webpage_simulate_login_website_and_some_notice/&quot;&gt;http://www.crifan.com/summary_about_flow_process_of_fetch_webpage_simulate_login_website_and_some_notice/&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="python" scheme="http://enjoyhot.github.io/categories/python/"/>
    
    
      <category term="spider" scheme="http://enjoyhot.github.io/tags/spider/"/>
    
      <category term="scrapy" scheme="http://enjoyhot.github.io/tags/scrapy/"/>
    
  </entry>
  
  <entry>
    <title>【machine learning】regularization        </title>
    <link href="http://enjoyhot.github.io/2015/01/21/machinelearning-linear-regularization/"/>
    <id>http://enjoyhot.github.io/2015/01/21/machinelearning-linear-regularization/</id>
    <published>2015-01-21T06:57:00.000Z</published>
    <updated>2016-07-16T06:35:11.706Z</updated>
    
    <content type="html">&lt;h1 id=&quot;一、机器学习范式&quot;&gt;&lt;a href=&quot;#一、机器学习范式&quot; class=&quot;headerlink&quot; title=&quot;一、机器学习范式&quot;&gt;&lt;/a&gt;一、机器学习范式&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;1、按数据类型划分(带标签与否)&lt;/strong&gt;&lt;br&gt;  &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150121143726836?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  这是从样本的数据进行划分，现实中大部分属于半监督学习，并且大部分数据是没分类好的。&lt;/p&gt;
&lt;p&gt;   &lt;strong&gt;监督学习：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150121143802217?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  &lt;strong&gt;例子：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;分类&lt;br&gt;       e.g. 文本分类  垃圾邮件过滤  搜索结果&lt;br&gt;回归分析&lt;br&gt;      e.g. 房价预测  股价预测&lt;br&gt;序列标注&lt;br&gt;      e.g. 词性标注&lt;br&gt;  输入:“我中了一张彩票”&lt;br&gt;  输出:“我/r  中/v 了/y /一/m /张/q /彩票/n&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;无监督学习：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150121143801625?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;例子：&lt;/strong&gt;&lt;br&gt;聚类&lt;br&gt;      e.g. 热点话题发现  社团发现&lt;br&gt;密度函数估计(probability density estimation )&lt;br&gt;      e.g. pdf估计&lt;br&gt;异常点检测(outlier detection)&lt;br&gt;      e.g. one-class  SVM, 去噪   &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;半监督学习：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150121143839828?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  核心思想&lt;br&gt;考虑如何利用少量的标注样本和大量的未标注样本进行训练和分类的问题&lt;/p&gt;
&lt;p&gt;例子：&lt;br&gt;分类&lt;br&gt;      e.g. 垃圾邮件过滤，半监督SVM&lt;br&gt;回归分析&lt;br&gt;聚类&lt;br&gt;e.g. GMM&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2、按学习过程划分&lt;/strong&gt;&lt;br&gt;主动学习、转导学习、强化学习&lt;/p&gt;
&lt;p&gt;主动学习(Active Learning)&lt;br&gt;    有少量标注的数据以及丰富的未标注数据 ，标注数据的成本很高，学习算法主动提出一些标注请求，将筛选过的数据交给专家进行标注，然后将标注的数据加入到训练集中，再进行训练。&lt;/p&gt;
&lt;p&gt;核心问题：怎么样筛选数据才能使得请求标注的次数尽量少而最终的结果又尽量好&lt;/p&gt;
&lt;p&gt;与半监督学习的区别：半监督学习算法不需要人工干预，基于自身对未标记数据加以利用，微博的用户推荐用户就是充当专家的角色。&lt;br&gt;问题可形式化为：&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150121143940875?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;转导学习(Transductive Learning)&lt;br&gt;一种通过观察特定的训练样本，进而预测特定的测试样本的方法在不同的测试集上会产生相互不一致的预测&lt;/p&gt;
&lt;p&gt;特点：&lt;br&gt;    1.建立一个更适用于问题域的模型，而非一个更通用的模型&lt;br&gt;    2.利用无标注的测试样本的信息发现聚簇，进而更有效地分类&lt;br&gt;    3.模型近似   &lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150121144045362?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;与半监督学习的区别：半监督学习不知道测试案例是什么，转导学习知道测试案                                                                                                                                                      例是什么&lt;br&gt; 半监督学习本质上是从特殊到一般(train)，一般到特殊(predict)的推理方法&lt;br&gt; 转导学习本质上是直接从特殊到特殊的推理方法，自动修正模型。&lt;br&gt;强化学习(Reinforcement Learning)&lt;br&gt;从环境状态到行为映射的学习，以使系统行为从环境中获得的累积奖赏值最大。该方法不同与监督学习技术那样通过正例、反例来告知采取何种行为，而是通过试错（trial-and-error）的方法来发现最优行为策略&lt;br&gt;   ）的方法来发现最优行为策略&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150121144116109?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;适用情况：适用于序列决策或者控制问题，很难有这么规则的样本。&lt;/p&gt;
&lt;p&gt;e.g. 象棋AI程序&lt;br&gt;解决思路:我们设计一个回报函数（reward function），如果learning agent（象棋AI程序）在决定一步后，获得了较好的结果，那么我们给agent一些回报（比如回报函数结果为正），得到较差的结果，那么回报函数为负。如果我们能够对每一步进行评价，得到相应的回报函数，那么就好办了，我们只需要找到一条回报值最大的路径（每步的回报之和最大），就认为是最佳的路径。&lt;br&gt;备注:一个强化学习的比赛 &lt;a href=&quot;http://ijcai-15.org/index.php/angry-birds-competition&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://ijcai-15.org/index.php/angry-birds-competition&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;二、正则化&quot;&gt;&lt;a href=&quot;#二、正则化&quot; class=&quot;headerlink&quot; title=&quot;二、正则化&quot;&gt;&lt;/a&gt;二、正则化&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;1、模型选择：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;a.若采用多项式拟合&lt;/p&gt;
&lt;p&gt;   &lt;img src=&quot;http://img.blog.csdn.net/20150121144234655?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;欠拟合(underfit,also high bias)&lt;br&gt;特征集过小，模型过于简单，会导致训练集的误差明显增大的现象。&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150121144311534?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt; 过拟合(overfit,also high variance)&lt;br&gt;非常多的特征，那么所学的Hypothesis有可能对训练集拟合的非常好,但是对测试集效果很差，即训练误差少，测试集误差大。&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150121144334591?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt; b.避免过拟合的方法——约束高阶多项式的系数&lt;/p&gt;
&lt;p&gt;以下是不同阶数的多项式相对应的系数&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150121144359426?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  定义损失函数：&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150121144414859?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt; 绿色曲线为最佳拟合，红色曲线为实际拟合结果。&lt;br&gt;罚项系数选择&lt;br&gt;   1.交叉验证&lt;br&gt;   2.超参数学习，解决最优化问题&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2、模型选择策略&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;a.代价函数(Cost function)&lt;br&gt;b.风险函数或期望风险(risk function)&lt;br&gt;①　定义为损失函数的期望&lt;br&gt;②　理论上模型f(x)关于联合分布P(X, Y)的平均意义下的损失&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150121144452140?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;①　学习的本质目标是选择期望风险最小的模型，由于联合分布P(X,Y)是未知的，风险函数Rexp(f)不能直接计算。&lt;br&gt;c.经验风险(empirical risk minimizatiion, ERM)&lt;br&gt;①模型f(x)关于训练数据集的平均损失称为经验风险，对期望风险的近似&lt;/p&gt;
&lt;p&gt;   &lt;img src=&quot;http://img.blog.csdn.net/20150121144526234?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt; 其实，最大似然估计等价于最小化经验风险。&lt;br&gt;②经验风险最小化(ERM)的策略认为，经验风险最小的模型是最优模型&lt;br&gt;③当样本容量是够大时，经验风险最小化能保证有很好的学习效果，在现实中被广泛应用&lt;br&gt;④当样本容量很小时，经验风险最小化学习的效果就未必很好，会产生“过拟合（over-fitting）”现象，如多项式阶数很大，出现过拟合。&lt;/p&gt;
&lt;p&gt;d.结构风险(structural risk minimization, SRM)&lt;br&gt;①在经验风险上加上表示模型复杂度的正则化项或罚项&lt;br&gt;②防止过拟合&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150121144554125?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt; 其中J(f)为模型的复杂度，是定义在假设空间 F 上的泛函数。&lt;br&gt;模型 f 越复杂，复杂度J(f)就越大；反之，模型 f 越简单，复杂度J(f)就越小&lt;/p&gt;
&lt;p&gt;③&lt;img src=&quot;http://img.blog.csdn.net/20150121144655020?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;决定了用以权衡经验风险和模型复杂度&lt;br&gt;④结构风险小需要经验风险与模型复杂度同时小，结构风险小的模型往往对训练数据以及未知的测试数据都有较好的预测，正则化的本质是控制模型的复杂度。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3、贝叶斯公式&lt;/strong&gt;&lt;br&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150121144633453?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt; 贝叶斯公式反映人们推理的方式,即人做实验时，先需要作出一定的假设(利用先验知识)，在假设的指导上去做实验，得到观察数据，最后利用实验数据修正对假设的理解，也就得到后验分布。&lt;br&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150121144737468?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;最小二乘问题的最大后验估计(MAP)&lt;br&gt;令&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150121144753578?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;最大后验估计等价于最小化正则化的平方损失函数，最大后验估计等价于最小化结构风险。&lt;br&gt;代价函数可改成：&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150121144901505?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;回顾下不加正则化的正规方程&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150121144854859?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;加正则化的正规方程，相当于对矩阵&lt;img src=&quot;http://img.blog.csdn.net/20150121144921640?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;所有特征值同时加了&lt;img src=&quot;http://img.blog.csdn.net/20150121144934031?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;，新矩阵&lt;img src=&quot;http://img.blog.csdn.net/20150121144954578?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;基本上是可逆的(除非原矩阵存在负&lt;img src=&quot;http://img.blog.csdn.net/20150121145005625?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;&quot;&gt;的特征)，即新的特征方程有唯一解。因而利用贝叶斯的正则化是分类算法中常用的方法。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;一、机器学习范式&quot;&gt;&lt;a href=&quot;#一、机器学习范式&quot; class=&quot;headerlink&quot; title=&quot;一、机器学习范式&quot;&gt;&lt;/a&gt;一、机器学习范式&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;1、按数据类型划分(带标签与否)&lt;/strong&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Machine Learning" scheme="http://enjoyhot.github.io/categories/Machine-Learning/"/>
    
    
      <category term="ML foundation" scheme="http://enjoyhot.github.io/tags/ML-foundation/"/>
    
  </entry>
  
  <entry>
    <title>我唱自己的歌</title>
    <link href="http://enjoyhot.github.io/2015/01/20/songsong/"/>
    <id>http://enjoyhot.github.io/2015/01/20/songsong/</id>
    <published>2015-01-20T13:30:26.000Z</published>
    <updated>2016-07-16T06:35:11.718Z</updated>
    
    <content type="html">&lt;p&gt;&lt;img src=&quot;https://enjoyhot.github.io/img/arcticle_pic/201501/012001.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;我唱自己的歌&lt;br&gt;在布满车前草的道路上&lt;br&gt;在灌木的集市上&lt;br&gt;在雪松和白桦树的舞会上&lt;br&gt;在那山野的原始欢乐上&lt;br&gt;我唱自己的歌&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;我唱自己的歌&lt;br&gt;在热电厂恐怖的烟云中&lt;br&gt;在变速箱复杂的组织中&lt;br&gt;在砂轮的亲吻中&lt;br&gt;在那社会文明的运行中&lt;br&gt;我唱自己的歌&lt;/p&gt;
&lt;p&gt;我唱自己的歌&lt;br&gt;即不陌生又不熟练&lt;br&gt;我是练习曲的孩子&lt;br&gt;愿意加入所有歌队&lt;br&gt;为了不让规范的人们知道&lt;br&gt;我唱自己的歌&lt;/p&gt;
&lt;p&gt;我唱歌，唱自己的歌&lt;br&gt;直到世界恢复了史前的寂寞&lt;br&gt;细长的月亮&lt;br&gt;从海边向我走来&lt;br&gt;轻轻地问：为什么？&lt;br&gt;你唱自己的歌&lt;/p&gt;
&lt;p&gt;——顾城&lt;/p&gt;
&lt;p&gt;在满是荆棘的历程中，我可能被泡沫掩埋，请让我还来得及向世界挑战。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;插入图的两种方法：&lt;/p&gt;
&lt;p&gt;内链（空间）：&lt;br&gt;&lt;img src=&quot;https://enjoyhot.github.io/img/arcticle_pic/201501/012001.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://zmingcx.com/free-fig-bed.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;外链（图床）&lt;/a&gt;：&lt;br&gt;&lt;img src=&quot;https://geekpics.net/images/2015/03/26/PEaRh7tB.jpg&quot; alt=&quot;PEaRh7tB.jpg&quot; border=&quot;0&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://enjoyhot.github.io/img/arcticle_pic/201501/012001.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;我唱自己的歌&lt;br&gt;在布满车前草的道路上&lt;br&gt;在灌木的集市上&lt;br&gt;在雪松和白桦树的舞会上&lt;br&gt;在那山野的原始欢乐上&lt;br&gt;我唱自己的歌&lt;br&gt;
    
    </summary>
    
      <category term="life" scheme="http://enjoyhot.github.io/categories/life/"/>
    
    
      <category term="life" scheme="http://enjoyhot.github.io/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>【machine learning】linear regression        </title>
    <link href="http://enjoyhot.github.io/2015/01/18/machinelearning-linear-regression/"/>
    <id>http://enjoyhot.github.io/2015/01/18/machinelearning-linear-regression/</id>
    <published>2015-01-18T11:43:00.000Z</published>
    <updated>2016-07-16T06:35:11.702Z</updated>
    
    <content type="html">&lt;h1 id=&quot;一、曲线拟合&quot;&gt;&lt;a href=&quot;#一、曲线拟合&quot; class=&quot;headerlink&quot; title=&quot;一、曲线拟合&quot;&gt;&lt;/a&gt;一、曲线拟合&lt;/h1&gt;&lt;p&gt;  &lt;strong&gt;1、问题引入&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  ①假设现在有一份关于某城市的住房面积与相应房价的数据集&lt;br&gt; &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118194525562&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  表1 居住面积与房价关系&lt;/p&gt;
&lt;p&gt;   &lt;img src=&quot;http://img.blog.csdn.net/20150118194601201&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  图1 居住面积与房价关系&lt;/p&gt;
&lt;p&gt;  那么给定这样一个数据集，我们怎么学习出一个以住房面积大小为自变量的用于预测该城市房价的函数？&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118194651511&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  问题可形式化为给定大小为m的训练样本集&lt;/p&gt;
&lt;p&gt;   &lt;img src=&quot;http://img.blog.csdn.net/20150118194745140&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;   我们希望学习的目标函数为&lt;/p&gt;
&lt;p&gt;   &lt;img src=&quot;http://img.blog.csdn.net/20150118194827576&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  房价预测本质上是回归问题&lt;/p&gt;
&lt;p&gt;  a、回归分析挖掘自变量与因变量之间的关系&lt;/p&gt;
&lt;p&gt;  b、有监督的学习问题，所有的样本点都带有目标变量&lt;/p&gt;
&lt;p&gt;  c、输出变量为连续值，可取任意实数&lt;/p&gt;
&lt;p&gt;  ②假设现在我们有份更详尽的数据集，它还记录了卧室的数量&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150118194839588&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  输入&lt;img src=&quot;http://img.blog.csdn.net/20150118195022813&quot; alt=&quot;&quot;&gt;，X=(x1,x2)&lt;/p&gt;
&lt;p&gt;  假设每个自变量都与因变量Y存在线性相关&lt;br&gt;  目标是学习出假设函数&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118195053077&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150118195116602&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  &lt;strong&gt;2、怎样建模&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  ①基本概念&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150118195123031&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Relationship&lt;br&gt;l Linear correlated?&lt;br&gt;l Nonlinear correlated?&lt;br&gt;Mining relation&lt;br&gt;l Correlation coefficient&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150118195224166&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118195321512&quot; alt=&quot;&quot;&gt;= 1时，称X,Y完全相关，X,Y之间具有线性函数关系&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Special Case&lt;br&gt;e.g. 猜想Y与X存在指数关系，观察&lt;br&gt;lnY与X的线性相关性&lt;/li&gt;
&lt;li&gt;General—Polynomial Curve Fit（多项式曲线拟合）&lt;br&gt;找到合适的阶数k，使等式成立，譬如logistic regression。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118195420995&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  ②多元变量线性回归&lt;/p&gt;
&lt;p&gt;  上文提到假设函数：&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150118195116602&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;参数或权重(反映每个自变量对输出的影响)，使线性函数空间参数化(h形式已知,用参数来刻画)为了表示方便，令x0(对应截距项)，则上式可写成&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150118195420995&quot; alt=&quot;&quot;&gt;&lt;br&gt;注：k与自变量的个数有关，此处k=2&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3、怎样获取参数&lt;/strong&gt;&lt;br&gt;合理的选择策略:对于该数据集的每一个样本，选定的参数使得尽可能接近y。在实际中，尽可能接近用代价函数来表示。&lt;br&gt;Cost Function(代价函数)&lt;br&gt;描述预测值与真实值之间的差距，从而优化目标函数参数，可以利用0-1损失，绝对值损失，平方损失，对数损失。对于线性回归问题，我们采用的目标函数为&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150118195547029&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt; 这是普通最小二乘回归模型(statistics)，可以利用概率论知识解释为什么可以，如下。&lt;/p&gt;
&lt;h1 id=&quot;二、概率解释&quot;&gt;&lt;a href=&quot;#二、概率解释&quot; class=&quot;headerlink&quot; title=&quot;二、概率解释&quot;&gt;&lt;/a&gt;二、概率解释&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;1、选择最小二乘(平方损失)代价函数的理由：&lt;/strong&gt;&lt;br&gt;我们做出如下假设：&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118195648742&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt; E(i)：误差项(没有model出的效应，e.g.遗漏了某些因素的影响)或随机噪声&lt;br&gt;进一步假设：&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150118195703812&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  即&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118195737118&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  注意，下面式子与这条式子等价。&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150118195805775&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118195832562&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  等价于&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150118195905040&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  之后我们就可以利用似然函数解释最小二乘代价函数：&lt;/p&gt;
&lt;p&gt;定义:给定随机变量X与参数，我们观察到结果Y的可能性&lt;/p&gt;
&lt;p&gt;   &lt;img src=&quot;http://img.blog.csdn.net/20150118200007034&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  由E(i)之间的独立性假设，得&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118200012234&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt; 简单解释一下，我们的目标，是实现在给定的情况下，对于m个样本的输入，能输出的m个y的概率的总乘积最大，那构建的模型就越准确了，即最大似然估计。&lt;/p&gt;
&lt;p&gt;定义：最大似然估计(maximum likelihood estimation)&lt;br&gt;    当给定似然函数(关联y与x的概率模型)时，一种合理的参数估计方法是尽可 能选择使数据出现的概率最大，即最大化似然函数。&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118200106250&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118200139308&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  实际上，常用的是对数似然：&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118200226280&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  因而，最大似然估计等价于最小化平方损失函数，得证。&lt;/p&gt;
&lt;h1 id=&quot;三、模型求解&quot;&gt;&lt;a href=&quot;#三、模型求解&quot; class=&quot;headerlink&quot; title=&quot;三、模型求解&quot;&gt;&lt;/a&gt;三、模型求解&lt;/h1&gt;&lt;p&gt;  &lt;strong&gt;1、梯度下降法&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;   (steepest??gradient??descent)&lt;/p&gt;
&lt;p&gt;  负梯度方向是函数值下降的方向，利用负梯度方向来决定每次迭代的新的搜索方向，使得每次迭代能使待优化的目标函数逐步减小。&lt;/p&gt;
&lt;p&gt; a：学习率&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118200331254&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  其中（关键）：&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150118200351160&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  LMS&lt;/p&gt;
&lt;p&gt;   更新法则：&lt;/p&gt;
&lt;p&gt;   &lt;img src=&quot;http://img.blog.csdn.net/20150118200456602&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  注意：每次参数更新只用到一个训练样本，样本维数等于维数。&lt;/p&gt;
&lt;p&gt;  &lt;strong&gt;2、批量梯度下降(batch gradient descent)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;   &lt;img src=&quot;http://img.blog.csdn.net/20150118200519721&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  每次参数更新，需要依赖训练集的所有样本。&lt;/p&gt;
&lt;p&gt;  对于线性回归问题，代价函数是凸二次规划函数，有全局最优解&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150118200553651&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  图1 梯度下降法迭代过程&lt;/p&gt;
&lt;p&gt;  &lt;strong&gt;3、随机梯度下降&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150118200642750&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt; 特点:&lt;br&gt;1.每次随机选取一个样本点 立即更新参数&lt;br&gt;2.单个样本点的代价函数值下降近似于总体的代价函数值下降&lt;br&gt;3.对步长选择敏感 可能会出现overshoot the minimum&lt;/p&gt;
&lt;p&gt;   &lt;img src=&quot;http://img.blog.csdn.net/20150118200743694&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  &lt;strong&gt;3、方法比较&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  1．梯度下降法是批量更新算法，随机梯度是在线算法&lt;/p&gt;
&lt;p&gt;  2．梯度法优化的是经验风险，随机梯度法优化的是泛化风险&lt;/p&gt;
&lt;p&gt;  3．梯度法可能陷入局部最优，随机梯度可能找到全局最优&lt;/p&gt;
&lt;p&gt;  4．梯度法对步长不敏感，随机梯度对步长选择敏感&lt;/p&gt;
&lt;p&gt;  5．梯度法对初始点(参数)选择敏感&lt;/p&gt;
&lt;p&gt;   &lt;img src=&quot;http://img.blog.csdn.net/20150118200745625&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  &lt;strong&gt;4、输入预处理&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  a.归一化&lt;/p&gt;
&lt;p&gt;  输入特征归一化，确保特征在相似的尺度里，但不一定所有的数据都需要归一化。&lt;/p&gt;
&lt;p&gt;  理由：梯度下降法可能会存执之字形地下降，影响算法的收敛速度。&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118200901959&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  一般做法：&lt;br&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118200904250&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  其中均值，最大值与最小值之差或标准差。&lt;/p&gt;
&lt;p&gt;  b.步长的选择&lt;/p&gt;
&lt;p&gt;  对于梯度下降法：&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118200954516&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  注意两个问题：&lt;/p&gt;
&lt;p&gt;  1、“调试”：如何确保梯度下降算法正确的执行；&lt;/p&gt;
&lt;p&gt; 2、如何选择正确的步长(learning rate):  α&lt;br&gt; 如何选择α-经验的方法：&lt;br&gt;…, 0.001, 0.003, 0.01, 0.03, 0.1, 0.3, 1…&lt;br&gt;     特别对于随机梯度下降法，步长的选择需满足两点：&lt;br&gt;①保证算法收敛性&lt;br&gt;②保证有机会搜索到全局最优解&lt;/p&gt;
&lt;p&gt;5、正规方程&lt;br&gt;假设函数作用于每个样本：&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150118201009929&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  则：&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118201053796&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  代价函数可改成：&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118201108382&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  此问题等价于：&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150118201233464&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  即两个向量之间的欧氏距离：&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118201251904&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  几何意义：&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;http://img.blog.csdn.net/20150118201243390&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150118201309328&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  需保证&lt;img src=&quot;http://img.blog.csdn.net/20150118201406113&quot; alt=&quot;&quot;&gt;可逆(可逆的充分条件:矩阵X各列线性无关)&lt;/p&gt;
&lt;p&gt;回顾一下，上面我们的方法是利用迭代的方式求出，从而使代价函数值最小，并没有求出代价函数。也就是说，所谓的最优解能否求得，不管是通过迭代的方式或是其它方式也好，符合上面的条件才行。&lt;/p&gt;
&lt;p&gt;但现实中的数据不是那么理想的。&lt;br&gt;若不可逆，如何求解？&lt;br&gt;1、求伪逆(statistics的解决方案)&lt;br&gt;2、去掉冗余的特征（线性相关）&lt;br&gt;3、去掉过多的特征，例如m &amp;lt;= n (m为样本数, n为特征数)&lt;/p&gt;
&lt;h1 id=&quot;四、小结&quot;&gt;&lt;a href=&quot;#四、小结&quot; class=&quot;headerlink&quot; title=&quot;四、小结&quot;&gt;&lt;/a&gt;四、小结&lt;/h1&gt;&lt;p&gt;1、梯度下降法&lt;br&gt;需要选择合适的learning rate α;&lt;br&gt;需要很多轮迭代&lt;br&gt;即使n很大的时候效果也很好（n为特征数，即维度）&lt;br&gt;2、正规方程&lt;br&gt;不需要选择α&lt;br&gt;不需要迭代，一次搞定&lt;/p&gt;
&lt;p&gt;  需要计算&lt;img src=&quot;http://img.blog.csdn.net/20150118201406113&quot; alt=&quot;&quot;&gt;，其时间复杂度是&lt;img src=&quot;http://img.blog.csdn.net/20150118201436923&quot; alt=&quot;&quot;&gt;&lt;br&gt;  n很大，就非常慢，可以考虑降维&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;一、曲线拟合&quot;&gt;&lt;a href=&quot;#一、曲线拟合&quot; class=&quot;headerlink&quot; title=&quot;一、曲线拟合&quot;&gt;&lt;/a&gt;一、曲线拟合&lt;/h1&gt;&lt;p&gt;  &lt;strong&gt;1、问题引入&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  ①假设现在有一份关于某城市的住房面积与相应房价的数据集&lt;br&gt;
    
    </summary>
    
      <category term="Machine Learning" scheme="http://enjoyhot.github.io/categories/Machine-Learning/"/>
    
    
      <category term="ML foundation" scheme="http://enjoyhot.github.io/tags/ML-foundation/"/>
    
  </entry>
  
  <entry>
    <title>python进行文档抽取与解析的简单实现        </title>
    <link href="http://enjoyhot.github.io/2015/01/18/python-analysis/"/>
    <id>http://enjoyhot.github.io/2015/01/18/python-analysis/</id>
    <published>2015-01-18T05:36:00.000Z</published>
    <updated>2016-07-16T06:35:11.714Z</updated>
    
    <content type="html">&lt;h1 id=&quot;一、前文&quot;&gt;&lt;a href=&quot;#一、前文&quot; class=&quot;headerlink&quot; title=&quot;一、前文&quot;&gt;&lt;/a&gt;一、前文&lt;/h1&gt;&lt;p&gt;  之前被叫去做网络爬虫，爬取新浪新闻的url，标题，内容和评论，不过在需求上有点改变，主要是评论的间隔被要求有‘\t’的分割，比如将&lt;/p&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;comment&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2014-12-10 18:53:20	1004400533	遗弃亲生骨肉猪狗不如，难道就不怕受到良心谴责？你能睡得安稳？&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2014-12-10 17:17:07	3294923134	这父亲是人吗？&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;comment&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;  改为&lt;br&gt;&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;comment&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2014-12-10 18:53:20 1004400533&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;遗弃亲生骨肉猪狗不如，难道就不怕受到良心谴责？你能睡得安稳？&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2014-12-10 17:17:07 3294923134&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;这父亲是人吗？&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;comment&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;  试过重新爬取，不过新浪在2015年后，做了些改变，一是评论api下的内容有了些修改，从原本的中文字符变为了’\u’，解决办法可以参考另一篇博文&lt;br&gt;  &lt;a href=&quot;http://blog.csdn.net/gugugujiawei/article/details/42559345&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;三张图告诉你python爬虫时转换\u中文字符的“坑”&lt;/a&gt;，二是在爬虫上需要做好浏览器模拟的工作，不然很容易被封杀，而且，在做大规模爬取的时候，需要利用多线程或者分布式的手段进行，多线程稍不注意，到了系统线程的上限，这是要注意的。&lt;/p&gt;
&lt;h1 id=&quot;二、抽取和解析&quot;&gt;&lt;a href=&quot;#二、抽取和解析&quot; class=&quot;headerlink&quot; title=&quot;二、抽取和解析&quot;&gt;&lt;/a&gt;二、抽取和解析&lt;/h1&gt;&lt;p&gt;  因为我想爬取这个页面（&lt;a href=&quot;http://news.sina.com.cn/society/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;social&lt;/a&gt;）一年的内容，已经超过2万了（只算那些有评论的新闻），所以经常第二天回来发现中途error。分布式计算的东西现在还没去学习，所以还是复习一下python。&lt;/p&gt;
&lt;p&gt;  在这个简短的程序中，用到了SGMLParser类进行解析，这个类封装了可以实现对具有标签的字符串的处理函数，当然没有标签也是可以用的，不需要冠以html文本种类的要求，网上很多例子可能会拿HTMLParser与SGMLParser进行说明，通过解析X.html进行说明。这里我只采用单线程的方法。&lt;/p&gt;
&lt;p&gt;  SGMLParser:&lt;/p&gt;
&lt;p&gt;  1、通过利用开关变量的方法进行标签间内容的抽取和解析，在此之前，需要进行变量的初始化，可以利用&lt;strong&gt;init&lt;/strong&gt;()或者&lt;strong&gt;reset&lt;/strong&gt;()，一般用&lt;strong&gt;reset&lt;/strong&gt;()。&lt;/p&gt;
&lt;p&gt;  2、start_x(),end_x(),handle_data()，这三个函数，第一个是当读取到&lt;x&gt;;时，执行的函数，第一个是当读取到&lt;/x&gt;;时，执行的函数,第三个是当遇到标签内的内容，就会调用这个函数，更详细一点可以参考&lt;br&gt;  &lt;a href=&quot;http://blog.csdn.net/nwpulei/article/details/7272832&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这篇博文&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;  变量说明：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;rootdir：原始文件目录&lt;br&gt;    rootdir2：需要存放转换好的文件目录&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;  方法说明：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;1、通过SGMLParser读取&lt;comment&gt;;&lt;/comment&gt;;中的内容，调用solve()函数，利用正则匹配的方法将原来不符合规范的空格替换为’\t’，返回需要替换的内容到comment变量&lt;br&gt;  2、利用正则匹配找到定位到&lt;comment&gt;;&lt;/comment&gt;;，替换为Parse类对象的comment值&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;  （正则表达式的方法参考以下注释）&lt;/p&gt;
&lt;p&gt;  完整代码：&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;#!/usr/bin/env python&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;# -*- coding: utf-8 -*-&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;from sgmllib import SGMLParser&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;import re,os&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;rootdir = &#39;F:\\Python27\\pythonproject\\fuck\\file1\\&#39;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;rootdir2 = &#39;F:\\Python27\\pythonproject\\fuck\\file2\\&#39;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;class Parse(SGMLParser):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    def __init__(self,filename):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.filename = filename  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.comment = &#39;&#39; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        SGMLParser.__init__(self)       &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    def reset(self):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.found_comment = False&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        SGMLParser.reset(self)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    def start_comment(self, attrs):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.found_comment = True&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    def end_comment(self):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.found_comment = False&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    def handle_data(self, text):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        if self.found_comment == True:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            self.comment=solve(self.filename,text)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;def solve(filename,text):   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    #找到3个或3个以上空格的地方，替换为&#39;\t&#39;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    strinfo = re.compile(&#39;(\s\s\s*)&#39;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    str_result = strinfo.sub(&#39;\t&#39;,text)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    return str_result&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;if __name__ == &#39;__main__&#39;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    global rootdir,rootdir2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    for parent,dirnames,filenames in os.walk(rootdir):    #三个参数：分别返回1.父目录 2.所有文件夹名字（不含路径） 3.所有文件名字&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        for filename in filenames:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            #print filename&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            filesource = open(rootdir+filename, &#39;a+&#39;)    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            s = filesource.read()            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            filesource.close()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            #初始化实例p,feed()函数为添加处理字符串&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            p = Parse(filename)            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            p.feed(s)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            filedes = open(rootdir2+filename, &#39;a+&#39;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            #因为原来原数据中存在不以&amp;lt;/comment&amp;gt;;结尾的内容，因此需要先做处理&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            pattern1=&#39;&amp;lt;/comment&amp;gt;;&#39;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            if re.findall(pattern1,s) == []:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                s=s+&#39;\n&amp;lt;/comment&amp;gt;;&#39;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;span style=&quot;white-space:pre&quot;&amp;gt;;	&amp;lt;/span&amp;gt;;    #定位到comment标签位置，([\s\S]*)能够匹配所有字符，包括换行符，然后替换&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            strinfo = re.compile(&#39;&amp;lt;comment&amp;gt;;([\s\S]*)&amp;lt;/comment&amp;gt;;&#39;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            str_result = strinfo.sub(&#39;&amp;lt;comment&amp;gt;;&#39;+p.comment+&#39;&amp;lt;/comment&amp;gt;;&#39;,s)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            filedes.write(str_result)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            filedes.close()&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; 结果：&lt;/p&gt;
&lt;p&gt;   &lt;img src=&quot;http://img.blog.csdn.net/20150118141804512?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;  注意：win7系统一般文件夹下的文件总数（包括文件夹）不能超过21845个，不然会提示错误。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;一、前文&quot;&gt;&lt;a href=&quot;#一、前文&quot; class=&quot;headerlink&quot; title=&quot;一、前文&quot;&gt;&lt;/a&gt;一、前文&lt;/h1&gt;&lt;p&gt;  之前被叫去做网络爬虫，爬取新浪新闻的url，标题，内容和评论，不过在需求上有点改变，主要是评论的间隔被要求有‘\t’的分割，比如将&lt;/p&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;comment&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2014-12-10 18:53:20	1004400533	遗弃亲生骨肉猪狗不如，难道就不怕受到良心谴责？你能睡得安稳？&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2014-12-10 17:17:07	3294923134	这父亲是人吗？&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;comment&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="python" scheme="http://enjoyhot.github.io/categories/python/"/>
    
    
      <category term="spider" scheme="http://enjoyhot.github.io/tags/spider/"/>
    
  </entry>
  
  <entry>
    <title>【python web学习】python web窥探        </title>
    <link href="http://enjoyhot.github.io/2015/01/15/python-web/"/>
    <id>http://enjoyhot.github.io/2015/01/15/python-web/</id>
    <published>2015-01-15T07:51:00.000Z</published>
    <updated>2016-07-16T06:35:11.718Z</updated>
    
    <content type="html">&lt;p&gt;本文为参考网上一些博客翻译以及想法，自己写的一篇总结博文，可能有重复的地方，纯粹总结只用。&lt;br&gt;阅读之前可参考:&lt;/p&gt;
&lt;p&gt;  1、&lt;a href=&quot;http://anandology.com/blog/how-to-write-a-web-framework-in-python/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;How to write a web framework in Python&lt;/a&gt;（作者&lt;a href=&quot;https://github.com/anandology&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;anandology&lt;/a&gt;是&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;web.py代码的两位维护者之一，另一位则是大名鼎鼎却英年早逝的&lt;a href=&quot;http://www.aaronsw.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AaronSwartz&lt;/a&gt;  ）&lt;br&gt;  2、&lt;a href=&quot;http://bitworking.org/news/Why_so_many_Python_web_frameworks&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Why so many Python web frameworks?&lt;/a&gt; 也是一篇很好的文章，也许它会让您对Python中Web框架的敬畏之心荡然&lt;/p&gt;
&lt;p&gt;无存:-)&lt;/p&gt;
&lt;p&gt;如果你打算用python进行网络开发的话，自己写的框架可以说是一种不受支持的想法，可能使用一个现成的Web框架（如&lt;a href=&quot;https://www.djangoproject.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Djang&lt;/a&gt;、&lt;a href=&quot;http://www.tornadoweb.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Tornado&lt;/a&gt; 、&lt;a href=&quot;http://webpy.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;web.py&lt;/a&gt; 、&lt;a href=&quot;http://zh.wikipedia.org/wiki/Pylons&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Pylons&lt;/a&gt;等）会是更合适的选择，毕竟都是大师级的作品。&lt;/p&gt;
&lt;h1 id=&quot;一、一次最简单的web之旅&quot;&gt;&lt;a href=&quot;#一、一次最简单的web之旅&quot; class=&quot;headerlink&quot; title=&quot;一、一次最简单的web之旅&quot;&gt;&lt;/a&gt;一、一次最简单的web之旅&lt;/h1&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;myweb.py&quot;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; wsgiref.simple_server &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; make_server, demo_app&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;httpd = make_server(&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;8086&lt;/span&gt;, demo_app)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;sa = httpd.socket.getsockname()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;http://&amp;#123;0&amp;#125;:&amp;#123;1&amp;#125;/&#39;&lt;/span&gt;.format(*sa)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Respond to requests until process is killed&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;httpd.serve_forever()&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在命令运行之后&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150115160426381?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;打开浏览器：&lt;a href=&quot;http://0.0.0.0:8086/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://0.0.0.0:8086/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;一行”Hello world!” 和 众多环境变量值。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150115160448158?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;定位到simple_server.py文件，我们看到make_server函数和WSGIServer类&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;make_server&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    host, port, app, server_class=WSGIServer, handler_class=WSGIRequestHandler&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;Create a new WSGI server listening on `host` and `port` for `app`&quot;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    server = server_class((host, port), handler_class)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    server.set_app(app)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; server&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;WSGIServer&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(HTTPServer)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;BaseHTTPServer that implements the Python WSGI protocol&quot;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    application = &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;server_bind&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;Override server_bind to store the server name.&quot;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        HTTPServer.server_bind(self)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.setup_environ()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setup_environ&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;# Set up base environment&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        env = self.base_environ = &amp;#123;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        env[&lt;span class=&quot;string&quot;&gt;&#39;SERVER_NAME&#39;&lt;/span&gt;] = self.server_name&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        env[&lt;span class=&quot;string&quot;&gt;&#39;GATEWAY_INTERFACE&#39;&lt;/span&gt;] = &lt;span class=&quot;string&quot;&gt;&#39;CGI/1.1&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        env[&lt;span class=&quot;string&quot;&gt;&#39;SERVER_PORT&#39;&lt;/span&gt;] = str(self.server_port)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        env[&lt;span class=&quot;string&quot;&gt;&#39;REMOTE_HOST&#39;&lt;/span&gt;]=&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        env[&lt;span class=&quot;string&quot;&gt;&#39;CONTENT_LENGTH&#39;&lt;/span&gt;]=&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        env[&lt;span class=&quot;string&quot;&gt;&#39;SCRIPT_NAME&#39;&lt;/span&gt;] = &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;get_app&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; self.application&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;set_app&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self,application)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.application = application&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看到，我们运行python文件后启动的是WSGIServer类对象（继承于HTTPServer，子类有run函数，后文会详细讲一下），而demo_app是一个拥有特定格式:接受两个参数，一个列表return&lt;/p&gt;
&lt;p&gt;对象的函数，抑或是类、类对象（见下文）。&lt;br&gt;很多时候，要简单写一个web框架，主要需要改动传入的app以及server。&lt;/p&gt;
&lt;h1 id=&quot;二、app的修改&quot;&gt;&lt;a href=&quot;#二、app的修改&quot; class=&quot;headerlink&quot; title=&quot;二、app的修改&quot;&gt;&lt;/a&gt;二、app的修改&lt;/h1&gt;&lt;p&gt;其中，可调用对象 包括 函数、方法、类 或者 具有&lt;strong&gt;call&lt;/strong&gt;方法的 实例；environ 是一个字典对象，包括CGI风格的环境变量（CGI-style environment variables）和 WSGI必需的变&lt;/p&gt;
&lt;p&gt;量（WSGI-required variables）；start_response 是一个可调用对象，它接受两个常规参数（status，response_headers）和 一个 默认参数（exc_info）；字符串迭代对象 可以是 字符&lt;/p&gt;
&lt;p&gt;串列表、生成器函数 或者 具有&lt;strong&gt;iter&lt;/strong&gt;方法的可迭代实例。更多细节参考&lt;a href=&quot;http://www.python.org/dev/peps/pep-0333/#specification-details&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Specification Details&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;   &lt;a href=&quot;http://www.python.org/dev/peps/pep-0333/#the-application-framework-side&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;The Application/Framework Side&lt;/a&gt;中给出了一个典型的application实现：&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;application.py&quot;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;simple_app&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(environ, start_response)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;Simplest possible application object&quot;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    status = &lt;span class=&quot;string&quot;&gt;&#39;200 OK&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    response_headers = [(&lt;span class=&quot;string&quot;&gt;&#39;Content-type&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;text/plain&#39;&lt;/span&gt;)]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    start_response(status, response_headers)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;string&quot;&gt;&#39;Hello world!\n&#39;&lt;/span&gt;]&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;替换原来自带的demo_app，重新运行之&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;code.py&quot;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; wsgiref.simple_server &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; make_server&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; application &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; my_app &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; app&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; __name__ == &lt;span class=&quot;string&quot;&gt;&#39;__main__&#39;&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    httpd = make_server(&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;8086&lt;/span&gt;, app)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    sa = httpd.socket.getsockname()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;http://&amp;#123;0&amp;#125;:&amp;#123;1&amp;#125;/&#39;&lt;/span&gt;.format(*sa)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;#Respond to requests until process is killed&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    httpd.serve_forever()&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这时就输出hello world!而没有环境变量。因为demo_app.py是这样的：&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;demo_app&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(environ,start_response)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; StringIO &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; StringIO&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   stdout = StringIO()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &amp;gt;;&amp;gt;;stdout, &lt;span class=&quot;string&quot;&gt;&quot;Hello world!&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &amp;gt;;&amp;gt;;stdout&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   h = environ.items(); h.sort()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; k,v &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; h:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &amp;gt;;&amp;gt;;stdout, k,&lt;span class=&quot;string&quot;&gt;&#39;=&#39;&lt;/span&gt;, repr(v)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   start_response(&lt;span class=&quot;string&quot;&gt;&quot;200 OK&quot;&lt;/span&gt;, [(&lt;span class=&quot;string&quot;&gt;&#39;Content-Type&#39;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;text/plain&#39;&lt;/span&gt;)])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [stdout.getvalue()]&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;三、URL调度修改&quot;&gt;&lt;a href=&quot;#三、URL调度修改&quot; class=&quot;headerlink&quot; title=&quot;三、URL调度修改&quot;&gt;&lt;/a&gt;三、URL调度修改&lt;/h1&gt;&lt;p&gt;之前的访问server都是基于host+port的形式，那要怎样实现url的分发呢。这需要对app进行修改才行。说到这里，就先将app从一个函数改为一个类吧，再做url区分处理。&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;application.py&quot;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;my_app&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self, environ, start_response)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.environ = environ&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.start = start_response&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__iter__&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        status = &lt;span class=&quot;string&quot;&gt;&#39;200 OK&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        response_headers = [(&lt;span class=&quot;string&quot;&gt;&#39;Content-type&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;text/plain&#39;&lt;/span&gt;)]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.start(status, response_headers)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Hello world!\n&quot;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;复习一下python类的语法，说说为什么可以这样写。开始的app可以这样用&lt;/p&gt;
  &lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;list = simple_app(a,b)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;   现在也可以这样用&lt;/p&gt;
  &lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;list = my_app(a,b)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;   注：其中参数来自&lt;strong&gt;init&lt;/strong&gt;()，返回值来自&lt;strong&gt;iter&lt;/strong&gt;()的return值（yield返回的就是一个可迭代对象），也许你会问，如果是传类对象的话呢？且看下下文。&lt;/p&gt;
&lt;p&gt;   再在return的函数即&lt;strong&gt;iter&lt;/strong&gt;()中修改根据不同的path进行不同返回。&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;application.py&quot;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;my_app&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self, environ, start_response)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.environ = environ&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.start = start_response&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__iter__&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        path = self.environ[&lt;span class=&quot;string&quot;&gt;&#39;PATH_INFO&#39;&lt;/span&gt;]  &lt;span class=&quot;comment&quot;&gt;#environ的作用看到了吧&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; path == &lt;span class=&quot;string&quot;&gt;&quot;/&quot;&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; self.GET_index()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;elif&lt;/span&gt; path == &lt;span class=&quot;string&quot;&gt;&quot;/hello&quot;&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; self.GET_hello()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; self.notfound()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;GET_index&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        status = &lt;span class=&quot;string&quot;&gt;&#39;200 OK&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        response_headers = [(&lt;span class=&quot;string&quot;&gt;&#39;Content-type&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;text/plain&#39;&lt;/span&gt;)]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.start(status, response_headers)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Welcome!\n&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;GET_hello&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        status = &lt;span class=&quot;string&quot;&gt;&#39;200 OK&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        response_headers = [(&lt;span class=&quot;string&quot;&gt;&#39;Content-type&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;text/plain&#39;&lt;/span&gt;)]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.start(status, response_headers)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Hello world!\n&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;notfound&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        status = &lt;span class=&quot;string&quot;&gt;&#39;404 Not Found&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        response_headers = [(&lt;span class=&quot;string&quot;&gt;&#39;Content-type&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;text/plain&#39;&lt;/span&gt;)]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.start(status, response_headers)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Not Found\n&quot;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; 这时用浏览器就可以访问/,/hello,其他访问为Not Found。&lt;/p&gt;
&lt;h1 id=&quot;四、重构&quot;&gt;&lt;a href=&quot;#四、重构&quot; class=&quot;headerlink&quot; title=&quot;四、重构&quot;&gt;&lt;/a&gt;四、重构&lt;/h1&gt;&lt;h2 id=&quot;1、正则匹配URL&quot;&gt;&lt;a href=&quot;#1、正则匹配URL&quot; class=&quot;headerlink&quot; title=&quot;1、正则匹配URL&quot;&gt;&lt;/a&gt;1、正则匹配URL&lt;/h2&gt;&lt;p&gt;消除URL硬编码，增加URL调度的灵活性：&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;67&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;68&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;69&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;70&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;71&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;72&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;73&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;74&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;75&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;76&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;77&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;78&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;79&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;80&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;81&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;82&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;83&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;84&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;85&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;86&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;87&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;88&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;89&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;90&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;91&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;92&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;93&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;94&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;95&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;96&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;97&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;98&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;99&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;100&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;101&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;102&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;103&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;104&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;105&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;106&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;107&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;108&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;109&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;110&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;111&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;112&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;113&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;114&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;115&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;116&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;117&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;application.py&quot;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; re &lt;span class=&quot;comment&quot;&gt;##########修改点&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;my_app&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    urls = (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        (&lt;span class=&quot;string&quot;&gt;&quot;/&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;index&quot;&lt;/span&gt;),&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        (&lt;span class=&quot;string&quot;&gt;&quot;/hello/(.*)&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;hello&quot;&lt;/span&gt;),&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ) &lt;span class=&quot;comment&quot;&gt;##########修改点，Django工程中url.py即视感&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self, environ, start_response)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.environ = environ&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.start = start_response&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__iter__&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;##########修改点&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        path = self.environ[&lt;span class=&quot;string&quot;&gt;&#39;PATH_INFO&#39;&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        method = self.environ[&lt;span class=&quot;string&quot;&gt;&#39;REQUEST_METHOD&#39;&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; pattern, name &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; self.urls:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            m = re.match(&lt;span class=&quot;string&quot;&gt;&#39;^&#39;&lt;/span&gt; + pattern + &lt;span class=&quot;string&quot;&gt;&#39;$&#39;&lt;/span&gt;, path) &lt;span class=&quot;comment&quot;&gt;#注意这里，url匹配函数名&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; m:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;#pass the matched groups as arguments to the function&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                args = m.groups()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                funcname = method.upper() + &lt;span class=&quot;string&quot;&gt;&#39;_&#39;&lt;/span&gt; + name&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; hasattr(self, funcname):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    func = getattr(self, funcname)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; func(*args)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; self.notfound()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;GET_index&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        status = &lt;span class=&quot;string&quot;&gt;&#39;200 OK&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        response_headers = [(&lt;span class=&quot;string&quot;&gt;&#39;Content-type&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;text/plain&#39;&lt;/span&gt;)]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.start(status, response_headers) &lt;span class=&quot;comment&quot;&gt;#遵循调用start_response后再return iterObject&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Welcome!\n&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;GET_hello&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self, name)&lt;/span&gt;:&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;##########修改点&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        status = &lt;span class=&quot;string&quot;&gt;&#39;200 OK&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        response_headers = [(&lt;span class=&quot;string&quot;&gt;&#39;Content-type&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;text/plain&#39;&lt;/span&gt;)]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.start(status, response_headers) &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Hello %s!\n&quot;&lt;/span&gt; % name&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;notfound&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        status = &lt;span class=&quot;string&quot;&gt;&#39;404 Not Found&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        response_headers = [(&lt;span class=&quot;string&quot;&gt;&#39;Content-type&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;text/plain&#39;&lt;/span&gt;)]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.start(status, response_headers)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Not Found\n&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;``` &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;## 2、消除GET_*方法中的重复代码，并且允许它们返回字符串：&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;```python &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;application.py&quot;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; re&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;my_app&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    urls = (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        (&lt;span class=&quot;string&quot;&gt;&quot;/&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;index&quot;&lt;/span&gt;),&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        (&lt;span class=&quot;string&quot;&gt;&quot;/hello/(.*)&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;hello&quot;&lt;/span&gt;),&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    )&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self, environ, start_response)&lt;/span&gt;:&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;##########修改点&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.environ = environ&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.start = start_response&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.status = &lt;span class=&quot;string&quot;&gt;&#39;200 OK&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self._headers = []&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__iter__&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;##########修改点&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        result = self.delegate() &lt;span class=&quot;comment&quot;&gt;#利用这个函数先进行返回结果的收集&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.start(self.status, self._headers) &lt;span class=&quot;comment&quot;&gt;#start_response&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;# 将返回值result（字符串 或者 字符串列表）转换为迭代对象&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; isinstance(result, basestring):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; iter([result])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; iter(result)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;delegate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;##########修改点&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        path = self.environ[&lt;span class=&quot;string&quot;&gt;&#39;PATH_INFO&#39;&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        method = self.environ[&lt;span class=&quot;string&quot;&gt;&#39;REQUEST_METHOD&#39;&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; pattern, name &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; self.urls:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            m = re.match(&lt;span class=&quot;string&quot;&gt;&#39;^&#39;&lt;/span&gt; + pattern + &lt;span class=&quot;string&quot;&gt;&#39;$&#39;&lt;/span&gt;, path)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; m:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;# pass the matched groups as arguments to the function&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                args = m.groups()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                funcname = method.upper() + &lt;span class=&quot;string&quot;&gt;&#39;_&#39;&lt;/span&gt; + name&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; hasattr(self, funcname):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    func = getattr(self, funcname)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; func(*args)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; self.notfound()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self, name, value)&lt;/span&gt;:&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;##########修改点&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self._headers.append((name, value))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;GET_index&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;##########修改点&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.header(&lt;span class=&quot;string&quot;&gt;&#39;Content-type&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;text/plain&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Welcome!\n&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;GET_hello&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self, name)&lt;/span&gt;:&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;##########修改点&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.header(&lt;span class=&quot;string&quot;&gt;&#39;Content-type&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;text/plain&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Hello %s!\n&quot;&lt;/span&gt; % name&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;notfound&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;##########修改点&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.status = &lt;span class=&quot;string&quot;&gt;&#39;404 Not Found&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.header(&lt;span class=&quot;string&quot;&gt;&#39;Content-type&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;text/plain&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Not Found\n&quot;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;3、抽象出框架&quot;&gt;&lt;a href=&quot;#3、抽象出框架&quot; class=&quot;headerlink&quot; title=&quot;3、抽象出框架&quot;&gt;&lt;/a&gt;3、抽象出框架&lt;/h2&gt;&lt;p&gt;为了将类my_app抽象成一个独立的框架，需要作出以下修改：&lt;/p&gt;
&lt;p&gt;   1、剥离出其中的具体处理细节：urls配置 和 GET_*方法（改成在多个类中实现相应的GET方法）&lt;/p&gt;
&lt;p&gt;   2、把方法header实现为类方法（classmethod），以方便外部作为功能函数调用&lt;/p&gt;
&lt;p&gt;   3、改用 具有&lt;strong&gt;call&lt;/strong&gt;方法的 实例 来实现application（上文提到）&lt;/p&gt;
&lt;p&gt;修改后的application.py（最终版本）：&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;application.py&quot;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; re&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;my_app&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;my simple web framework&quot;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    headers = []&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self, urls=&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;, fvars=&amp;#123;&amp;#125;)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self._urls = urls&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self._fvars = fvars&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__call__&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self, environ, start_response)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self._status = &lt;span class=&quot;string&quot;&gt;&#39;200 OK&#39;&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;# 默认状态OK&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;del&lt;/span&gt; self.headers[:] &lt;span class=&quot;comment&quot;&gt;# 清空上一次的headers&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        result = self._delegate(environ)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        start_response(self._status, self.headers)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;# 将返回值result（字符串 或者 字符串列表）转换为迭代对象&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; isinstance(result, basestring):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; iter([result])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; iter(result)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;_delegate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self, environ)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        path = environ[&lt;span class=&quot;string&quot;&gt;&#39;PATH_INFO&#39;&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        method = environ[&lt;span class=&quot;string&quot;&gt;&#39;REQUEST_METHOD&#39;&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; pattern, name &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; self._urls:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            m = re.match(&lt;span class=&quot;string&quot;&gt;&#39;^&#39;&lt;/span&gt; + pattern + &lt;span class=&quot;string&quot;&gt;&#39;$&#39;&lt;/span&gt;, path)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; m:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;# pass the matched groups as arguments to the function&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                args = m.groups()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                funcname = method.upper() &lt;span class=&quot;comment&quot;&gt;# 方法名大写（如GET、POST）&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                klass = self._fvars.get(name) &lt;span class=&quot;comment&quot;&gt;# 根据字符串名称查找类对象&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; hasattr(klass, funcname):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    func = getattr(klass, funcname)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; func(klass(), *args)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; self._notfound()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;_notfound&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self._status = &lt;span class=&quot;string&quot;&gt;&#39;404 Not Found&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.header(&lt;span class=&quot;string&quot;&gt;&#39;Content-type&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;text/plain&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Not Found\n&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;    @classmethod&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(cls, name, value)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        cls.headers.append((name, value))&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;到这里，基本上就算是小功告成了，但只是了解了怎么用那些子类，大篇幅还是讲怎么设计。窥探一下wsgiref.simple_server。&lt;/p&gt;
&lt;h1 id=&quot;五、wsgiref原理介绍&quot;&gt;&lt;a href=&quot;#五、wsgiref原理介绍&quot; class=&quot;headerlink&quot; title=&quot;五、wsgiref原理介绍&quot;&gt;&lt;/a&gt;五、wsgiref原理介绍&lt;/h1&gt;&lt;h2 id=&quot;1、概述&quot;&gt;&lt;a href=&quot;#1、概述&quot; class=&quot;headerlink&quot; title=&quot;1、概述&quot;&gt;&lt;/a&gt;1、概述&lt;/h2&gt;&lt;p&gt;a.什么是WSGI, WSGI application, WSGI server, WSGI middleware.&lt;/p&gt;
&lt;p&gt;WSGI是关于Python脚本与Web服务器交互的协议，wsgi将 web 组件分为三类： web服务器,web中间件,web应用程序。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150115170410237?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;b.WSGI Server有哪些&lt;/p&gt;
&lt;p&gt;比如 Django、CherryPy 都自带 WSGI server,主要是测试用途, 发布时则使用生产环境的 WSGI server，例如Apache，nginx等，而有些 WSGI 下的框架比如 pylons、bfg 等, 自己不实现 WSGI server。&lt;/p&gt;
&lt;p&gt;wsgiref就是python自带的WSGI server。上面提到的app需要传入的两个参数application(environ, start_response)，其实就是一个接口两个参数的集合体。&lt;a href=&quot;http://blog.csdn.net/sraing/article/details/8455242&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;一篇博文&lt;/a&gt;&lt;br&gt;这样说明：&lt;/p&gt;
&lt;p&gt;wsgi server 基本工作流程：&lt;/p&gt;
&lt;p&gt;1、服务器创建socket，监听端口，等待客户端连接。&lt;/p&gt;
&lt;p&gt;2、当有请求来时，服务器解析客户端信息放到环境变量environ中，并调用绑定的handler来处理请求。&lt;/p&gt;
&lt;p&gt;3、handler解析这个http请求，将请求信息例如method，path等放到environ中。&lt;/p&gt;
&lt;p&gt;4、wsgi handler再将一些服务器端信息也放到environ中，最后服务器信息，客户端信息，本次请求信息全部都保存到了环境变量environ中。&lt;/p&gt;
&lt;p&gt;5、wsgi handler 调用注册的wsgi app，并将environ和回调函数传给wsgi app&lt;/p&gt;
&lt;p&gt;6、wsgi app 将reponse header/status/body 回传给wsgi handler&lt;/p&gt;
&lt;p&gt;7、最终handler还是通过socket将response信息塞回给客户端。&lt;/p&gt;
&lt;h2 id=&quot;2、组成（python2-7-8）&quot;&gt;&lt;a href=&quot;#2、组成（python2-7-8）&quot; class=&quot;headerlink&quot; title=&quot;2、组成（python2.7.8）&quot;&gt;&lt;/a&gt;2、组成（python2.7.8）&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150115171915328?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150115172004250?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;simple_server&lt;/p&gt;
&lt;p&gt;这一模块实现了一个简单的 HTTP 服务器，并给出了一个简单的 demo，运行：&lt;/p&gt;
&lt;p&gt;python simple_server.py&lt;/p&gt;
&lt;p&gt;会启动这个demo，运行一次请求，并把这次请求中涉及到的环境变量在浏览器中显示出来。&lt;/p&gt;
&lt;p&gt;handlers&lt;/p&gt;
&lt;p&gt;simple_server模块将HTTP服务器分成了 Server 部分和Handler部分，前者负责接收请求，后者负责具体的处理， 其中Handler部分主要在handlers中实现。&lt;/p&gt;
&lt;p&gt;headers&lt;/p&gt;
&lt;p&gt;这一模块主要是为HTTP协议中header部分建立数据结构。&lt;/p&gt;
&lt;p&gt;util&lt;/p&gt;
&lt;p&gt;这一模块包含了一些工具函数，主要用于对环境变量，URL的处理。&lt;/p&gt;
&lt;p&gt;validate&lt;/p&gt;
&lt;p&gt;这一模块提供了一个验证工具，可以用于验证你的实现是否符合WSGI标准。&lt;/p&gt;
&lt;p&gt;simple_server 模块主要有两部分内容，上面一到四的内容可以总结。&lt;/p&gt;
&lt;p&gt;应用程序&lt;/p&gt;
&lt;p&gt;函数demo_app是应用程序部分&lt;/p&gt;
&lt;p&gt;服务器程序&lt;/p&gt;
&lt;p&gt;服务器程序主要分成Server 和 Handler两部分，另外还有一个函数 make_server 用来生成一个服务器实例&lt;/p&gt;
&lt;p&gt;各种继承关系：&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# M:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         +------------+&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         | BaseServer |&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         +------------+&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#               |&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#               V&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         +------------+&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         | TCPServer  |&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         +------------+&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#               |&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#               V&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         +------------+&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         | HTTPServer |&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         +------------+&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#               |&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#               V&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         +------------+&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         | WSGIServer |&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         +------------+&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;# M:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         +--------------------+&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         | BaseRequestHandler |&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         +--------------------+&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#                   |&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#                   V&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         +-----------------------+&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         | StreamRequestHandler  |&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         +-----------------------+&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#                   |&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#                   V&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         +------------------------+&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         | BaseHTTPRequestHandler |&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         +------------------------+&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#                   |&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#                   V&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         +--------------------+&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         | WSGIRequestHandler |&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#         +--------------------+&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# M:&lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;#        +-------------+&lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;#        | BaseHandler |  &lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;#        +-------------+&lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;#               |&lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;#               V&lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;#       +----------------+&lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;#       | SimpleHandler  |&lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;#       +----------------+&lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;#               |&lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;#               V&lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;#       +---------------+&lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;#       | ServerHandler |&lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;#       +---------------+&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在调用make_server的时候，都发生了什么&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20150115173003782?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;  再这里，就不细讲handler的处理过程了，很多时候网络handler的研究需要看源码才能真正消化。&lt;/p&gt;
&lt;p&gt;  以下完全引用&lt;a href=&quot;http://blog.csdn.net/on_1y/article/details/18818081&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;on_1y&lt;/a&gt;的一篇博文，该博文讲得很细，不过需要研究源码才能真正消化。可以先看doc:&lt;a href=&quot;https://docs.python.org/2/library/wsgiref.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://docs.python.org/2/library/wsgiref.html&lt;/a&gt;&lt;br&gt;再看源码:&lt;a href=&quot;https://pypi.python.org/pypi/wsgiref&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://pypi.python.org/pypi/wsgiref&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;  headers&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20140127181854562?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvb25fMXk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt; 这个模块是对HTTP 响应部分的头部设立的数据结构，实现了一个类似Python 中 dict的数据结构。可以看出，它实现了一些函数来支持一些运算符，例如 &lt;strong&gt;len&lt;/strong&gt;, &lt;strong&gt;setitem&lt;/strong&gt;, &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;getitem&lt;/strong&gt;, &lt;strong&gt;delitem&lt;/strong&gt;, &lt;strong&gt;str&lt;/strong&gt;, 另外，还实现了 dict 操作中的get, keys, values函数&lt;br&gt;  &lt;a href=&quot;https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-24-wsgiref-src-intro.md#util&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;/a&gt;&lt;br&gt;util&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20140127181908062?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvb25fMXk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;  这个模块主要就是一些有用的函数，用于处理URL, 环境变量。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/minixalpha/StrayBirds/blob/gh-pages/_posts/2014-01-24-wsgiref-src-intro.md#validate&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;/a&gt;&lt;br&gt;  validate&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20140127181921109?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvb25fMXk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;  这个模块主要是检查你对WSGI的实现，是否满足标准，包含三个部分：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;validator&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;Wrapper&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;Check&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;  validator 调用后面两个部分来完成验证工作，可以看出Check部分对WSGI中规定的各个部分进行了检查。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;本文为参考网上一些博客翻译以及想法，自己写的一篇总结博文，可能有重复的地方，纯粹总结只用。&lt;br&gt;阅读之前可参考:&lt;/p&gt;
&lt;p&gt;  1、&lt;a href=&quot;http://anandology.com/blog/how-to-write-a-web-framework-in-python/&quot;&gt;How to write a web framework in Python&lt;/a&gt;（作者&lt;a href=&quot;https://github.com/anandology&quot;&gt;anandology&lt;/a&gt;是&lt;br&gt;
    
    </summary>
    
      <category term="python" scheme="http://enjoyhot.github.io/categories/python/"/>
    
    
      <category term="python web" scheme="http://enjoyhot.github.io/tags/python-web/"/>
    
  </entry>
  
  <entry>
    <title>python spider error occurs to Chinese words</title>
    <link href="http://enjoyhot.github.io/2015/01/09/python-chinese/"/>
    <id>http://enjoyhot.github.io/2015/01/09/python-chinese/</id>
    <published>2015-01-09T11:51:00.000Z</published>
    <updated>2016-07-16T06:35:11.714Z</updated>
    
    <content type="html">&lt;p&gt;平台为win7系统&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150109195105296?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150109195122035?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;http://img.blog.csdn.net/20150109195117687?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VndWd1amlhd2Vp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center&quot; alt=&quot;image_mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;  一劳永逸的方法：&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;s=s.replace(&lt;span class=&quot;string&quot;&gt;&quot;&#39;&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;&quot;&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;s=s.replace(&lt;span class=&quot;string&quot;&gt;&quot;\n&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;s1=&lt;span class=&quot;string&quot;&gt;&quot;u&#39;&quot;&lt;/span&gt;+s+&lt;span class=&quot;string&quot;&gt;&quot;&#39;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt;:                        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ss=eval(s1)                 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;except&lt;/span&gt;:                         &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; 将’转换为“，将\n去掉。利用eval转化即可。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;平台为win7系统&lt;br&gt;
    
    </summary>
    
      <category term="python" scheme="http://enjoyhot.github.io/categories/python/"/>
    
    
      <category term="python" scheme="http://enjoyhot.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>今天真是窘迫的一天</title>
    <link href="http://enjoyhot.github.io/2014/12/28/poor-day/"/>
    <id>http://enjoyhot.github.io/2014/12/28/poor-day/</id>
    <published>2014-12-28T12:23:50.000Z</published>
    <updated>2016-07-16T06:35:11.710Z</updated>
    
    <content type="html">&lt;p&gt;  今天是一个窘迫的一天，昨天上午去实验室，发现前天跑的爬虫还是没爬完，郁闷，有的爬的数据比它多用几个小时就跑完了，然后又开了一个cmd窗口继续跑另一个爬虫，后来司机，鼠标也动不了，强制关机后不进行硬盘检查（在笔记本经常这样做，省时），不过在台式机还是第一次这么干。今天终于尝到苦头。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;  今天依旧跑的是昨天强制关机后的那个程序（注意特指），不过下午才到的实验室，居然比昨天还慢，一半都没有。索性不理它，继续搞，再开窗口，到了四点多的时候，厄运来了，自动关机。自动重启，硬盘检查，不过启动失败直接进入系统修复，失败。想到的是四种方法，系统修复，安全模式，pe系统的修复，重装系统，后来真的只能重装系统了，pe系统修复那步也许做得不太好，不过以防万一，就将c盘中的虚拟机拷到f盘。&lt;/p&gt;
&lt;p&gt;  也许是我频繁得对硬盘io进行操作，导致D盘受损，开始以为是系统问题，想继续做个系统，边做边上网搜方法，用了一下diskGenius，但最终还是得将d盘格式化，毕竟里面的东西我只放了个Dreamweaver而已，大不了再下一个。&lt;/p&gt;
&lt;p&gt;  看上去好像都搞定了的样子，其实最重要的事情能不能成功都是还是挺担心的，虽说备份了虚拟机在c盘的东西，不过还是第一次要想这么做。尼玛看来我没有好好调研清楚怎么迁移virtualbox的系统就开始弄，确实有点草率，映射的硬盘我都不记得在哪里，拷过来的东西只有几兆，显然错了。近乎崩溃……工程还没有完全拷过来（这已经够崩溃了）&lt;/p&gt;
&lt;p&gt;  后来逐渐深入才知道，要重新搭一个环境也是挺久的，django,mongodb以及webvirtmgr附带的东西，数据库记得当时调试的时候是手打出来的假数据，现在不知新建一个空的会不会报错。&lt;/p&gt;
&lt;p&gt;  明天又是一个挑战的一天，挺浪费时间的，又得搭环境，又得写服务器信息栏目后台，还好前端一直在win7下写的，之前后天边调编写用了接近3天，希望在之前的经验下，能在明天内既搭好环境又一气呵成写好后台，老天保佑，我不想做太多无谓时间牺牲，虽说反驳者觉得可以练练手，写重复的东西你说呢！？&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;  今天是一个窘迫的一天，昨天上午去实验室，发现前天跑的爬虫还是没爬完，郁闷，有的爬的数据比它多用几个小时就跑完了，然后又开了一个cmd窗口继续跑另一个爬虫，后来司机，鼠标也动不了，强制关机后不进行硬盘检查（在笔记本经常这样做，省时），不过在台式机还是第一次这么干。今天终于尝到苦头。&lt;br&gt;
    
    </summary>
    
      <category term="life" scheme="http://enjoyhot.github.io/categories/life/"/>
    
    
      <category term="实验室" scheme="http://enjoyhot.github.io/tags/%E5%AE%9E%E9%AA%8C%E5%AE%A4/"/>
    
      <category term="spider" scheme="http://enjoyhot.github.io/tags/spider/"/>
    
  </entry>
  
  <entry>
    <title>考研日</title>
    <link href="http://enjoyhot.github.io/2014/12/27/postgraduate-exam/"/>
    <id>http://enjoyhot.github.io/2014/12/27/postgraduate-exam/</id>
    <published>2014-12-27T12:45:09.000Z</published>
    <updated>2016-07-16T06:35:11.710Z</updated>
    
    <content type="html">&lt;p&gt;  微信发一条真诚祝福，也是对自己的祝福勉励，不忘自己是怎么走到这一步，运气背，但也阴差阳错。&lt;/p&gt;
&lt;p&gt;  今天是考研的第一天，曾经很担心这一天的到来，直到9月中旬。&lt;br&gt;依稀记得，8月刚过20，内心甚是纠结，最后还是面对现实，做两手准备，虽是不甘，也无可奈何。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;  今天起得不算太晚，9点出头，不想去实验室，只想到图书馆坐坐，看看书，一到那里，人出奇得多，不过转念一想，考试月，理所当然，自从大四后关于自习室的念想都是研究生层面啊。&lt;/p&gt;
&lt;p&gt;  研究生阶段的方向，如无意外，无其它偏好，应该就是数据挖掘，喜好程度，中偏上而已。做做工程也好，搞搞理论也罢，出路两条，创业或工作，不止说说而已，咳咳。&lt;/p&gt;
&lt;p&gt;  慢慢接近自己想得到的，不忘初衷，成长当如此。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;  微信发一条真诚祝福，也是对自己的祝福勉励，不忘自己是怎么走到这一步，运气背，但也阴差阳错。&lt;/p&gt;
&lt;p&gt;  今天是考研的第一天，曾经很担心这一天的到来，直到9月中旬。&lt;br&gt;依稀记得，8月刚过20，内心甚是纠结，最后还是面对现实，做两手准备，虽是不甘，也无可奈何。&lt;br&gt;
    
    </summary>
    
      <category term="life" scheme="http://enjoyhot.github.io/categories/life/"/>
    
    
      <category term="life" scheme="http://enjoyhot.github.io/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>html与javascript之网络篇</title>
    <link href="http://enjoyhot.github.io/2014/12/26/html-javascript-1/"/>
    <id>http://enjoyhot.github.io/2014/12/26/html-javascript-1/</id>
    <published>2014-12-26T06:09:00.000Z</published>
    <updated>2016-07-16T06:35:11.698Z</updated>
    
    <content type="html">&lt;p&gt;   此篇依然与前一篇动态篇环境一样，基于jquery&lt;/p&gt;
&lt;p&gt;  #一、表单提交（post的同步加载）&lt;br&gt;  &lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt; &amp;lt;form method=&lt;span class=&quot;string&quot;&gt;&quot;post&quot;&lt;/span&gt; onSubmit=&lt;span class=&quot;string&quot;&gt;&quot;return check_recover()&quot;&lt;/span&gt;&amp;gt;;	                          						&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;javascript:void(0)&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;allSelect2&quot;&lt;/span&gt; &amp;gt;&lt;/span&gt;;全部&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &amp;gt;&lt;/span&gt;;-&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;;                        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;javascript:void(0)&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;noneSelect2&quot;&lt;/span&gt; &amp;gt;&lt;/span&gt;;无&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &amp;gt;&lt;/span&gt;;-&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;;                        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;submit&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;btn btn-primary&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;recover&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;恢复所选&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;;           &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;button&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;button&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;btn btn-primary&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;;删除所选&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;button&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;form&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt; 
&lt;p&gt; 解释：当点击submit对应的按钮时，会直接提交到服务器，当此前为调用check_recover()函数，在这个函数中可以判断提交的内容是否合法，如果是则return true，则完成表单提交，实现同步加载。&lt;/p&gt;
&lt;h1 id=&quot;二、ajax异步加载&quot;&gt;&lt;a href=&quot;#二、ajax异步加载&quot; class=&quot;headerlink&quot; title=&quot;二、ajax异步加载&quot;&gt;&lt;/a&gt;二、ajax异步加载&lt;/h1&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;post_message1&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//alert(&#39;success&#39;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;data=&amp;#123;&lt;span class=&quot;string&quot;&gt;&#39;type&#39;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;2&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;ip&#39;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&#39;127.0.0.1&#39;&lt;/span&gt;&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$.post($(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;).attr(&lt;span class=&quot;string&quot;&gt;&#39;action&#39;&lt;/span&gt;), data, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;data,status,xhr&lt;/span&gt;)&lt;/span&gt;&amp;#123;		&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(status==&lt;span class=&quot;string&quot;&gt;&quot;success&quot;&lt;/span&gt;)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;change();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;post_message2&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$.getJSON(&lt;span class=&quot;string&quot;&gt;&quot;yoururl&quot;&lt;/span&gt;,&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;data&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;dosomething();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt; 解释：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  1.当调用post_message()函数时，发送data数据到服务器，当成功返回时，再调用change()函数。&lt;/p&gt;
&lt;p&gt;  2.当调用post_message()函数时，访问url为yoururl的链接，返回含有data数据的response，然后调用dosomething()函数。&lt;/p&gt;
&lt;h1 id=&quot;三、刷新当前页面&quot;&gt;&lt;a href=&quot;#三、刷新当前页面&quot; class=&quot;headerlink&quot; title=&quot;三、刷新当前页面&quot;&gt;&lt;/a&gt;三、刷新当前页面&lt;/h1&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.location.reload();&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;四、定时执行某些特定操作，譬如更新图&quot;&gt;&lt;a href=&quot;#四、定时执行某些特定操作，譬如更新图&quot; class=&quot;headerlink&quot; title=&quot;四、定时执行某些特定操作，譬如更新图&quot;&gt;&lt;/a&gt;四、定时执行某些特定操作，譬如更新图&lt;/h1&gt;   &lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;		&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;window&lt;/span&gt;.setInterval(&lt;span class=&quot;string&quot;&gt;&#39;hostusage()&#39;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2000&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; 解释：两秒调用hostusage()函数一次&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;   此篇依然与前一篇动态篇环境一样，基于jquery&lt;/p&gt;
&lt;p&gt;  #一、表单提交（post的同步加载）&lt;br&gt;  &lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt; &amp;lt;form method=&lt;span class=&quot;string&quot;&gt;&quot;post&quot;&lt;/span&gt; onSubmit=&lt;span class=&quot;string&quot;&gt;&quot;return check_recover()&quot;&lt;/span&gt;&amp;gt;;	                          						&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;javascript:void(0)&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;allSelect2&quot;&lt;/span&gt; &amp;gt;&lt;/span&gt;;全部&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &amp;gt;&lt;/span&gt;;-&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;;                        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;javascript:void(0)&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;noneSelect2&quot;&lt;/span&gt; &amp;gt;&lt;/span&gt;;无&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &amp;gt;&lt;/span&gt;;-&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;;                        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;submit&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;btn btn-primary&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;recover&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;恢复所选&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;;           &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;button&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;button&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;btn btn-primary&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;;删除所选&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;button&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;form&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="前端" scheme="http://enjoyhot.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="js func" scheme="http://enjoyhot.github.io/tags/js-func/"/>
    
  </entry>
  
  <entry>
    <title>html与javascript之动态篇        </title>
    <link href="http://enjoyhot.github.io/2014/12/26/html-javascript-2/"/>
    <id>http://enjoyhot.github.io/2014/12/26/html-javascript-2/</id>
    <published>2014-12-26T05:26:00.000Z</published>
    <updated>2016-07-16T06:35:11.698Z</updated>
    
    <content type="html">&lt;p&gt;   以下所讲内容采用bootstrap模板，jquery库，对于原生html大致也同样适用&lt;/p&gt;
&lt;h1 id=&quot;一、侧边栏分页&quot;&gt;&lt;a href=&quot;#一、侧边栏分页&quot; class=&quot;headerlink&quot; title=&quot;一、侧边栏分页&quot;&gt;&lt;/a&gt;一、侧边栏分页&lt;/h1&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt; 
&lt;pre&gt;&lt;code&gt;&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;navbar-default sidebar&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;role&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;navigation&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;sidebar-nav navbar-collapse&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;ul&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;nav&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;side-menu&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;sidebar-search&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;input-group custom-search-form&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;form-control&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;placeholder&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;Search...&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;span&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;input-group-btn&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;button&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;btn btn-default&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;button&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;fa fa-search&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;i&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;button&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;span&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- /input-group --&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          	 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;#&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;fa fa-wrench fa-fw&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;i&lt;/span&gt;&amp;gt;&lt;/span&gt; 审核业务&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;span&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;fa arrow&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;span&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;ul&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;nav nav-second-level&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;&amp;#123;% url &#39;user-review&#39; %&amp;#125;&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;用户审核业务&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;&amp;#123;% url &#39;device-review&#39; %&amp;#125;&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;设备审核业务&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;                                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;&amp;#123;% url &#39;middleware-review&#39; %&amp;#125;&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;中间件审核业务&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;ul&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- /.nav-second-level --&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;                                                                                                &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;ul&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- /.sidebar-collapse --&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- /.navbar-static-side --&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt; 当点击某一项跳转到另外页面时，可以在相应的html页面中改为&lt;/p&gt;
 &lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;active&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;#&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;fa fa-wrench fa-fw&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;i&lt;/span&gt;&amp;gt;&lt;/span&gt; 审核业务&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;span&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;fa arrow&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;span&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;ul&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;nav nav-second-level&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;active&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;&amp;#123;% url &#39;user-review&#39; %&amp;#125;&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;用户审核业务&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;&amp;#123;% url &#39;device-review&#39; %&amp;#125;&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;设备审核业务&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;                                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;&amp;#123;% url &#39;middleware-review&#39; %&amp;#125;&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;中间件审核业务&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;ul&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; 	&lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- /.nav-second-level --&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;li&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;二、单击按钮弹出modal对话框&quot;&gt;&lt;a href=&quot;#二、单击按钮弹出modal对话框&quot; class=&quot;headerlink&quot; title=&quot;二、单击按钮弹出modal对话框&quot;&gt;&lt;/a&gt;二、单击按钮弹出modal对话框&lt;/h1&gt; &lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;button&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;button&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;btn btn-primary&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;data-toggle&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;modal&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;data-target&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;#myModal&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;新增用户&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;button&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; modal为嵌入在html div中的html隐藏文本&lt;/p&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;aria-hidden&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;aria-labelledby&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;myModalLabel&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;modal fade&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;myModal&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;role&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;dialog&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;tabindex&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;-1&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;modal-dialog&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;modal-content&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;modal-header&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;style&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;background:#d9edf7&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;button&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;aria-hidden&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;close&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;data-dismiss&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;modal&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;button&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;×&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;button&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;h4&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;modal-title&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;myModalLabel&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;新增用户信息&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;h4&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;                                                                                              &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;modal-body form-horizontal&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;                                  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;form-group&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                              &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;for&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;username&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;col-sm-2 control-label&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;用户名&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;label&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                              &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;col-sm-10&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                              &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;form-control&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;username&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;placeholder&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;用户名&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;                                                                                                                                     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;modal-footer&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;hidden&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;add-name&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;add-id&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;button&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;btn btn-default&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;data-dismiss&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;modal&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;button&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;关闭&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;button&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;btn btn-primary&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;submit&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;addButton&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;确定&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;                                    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;三、按钮触发事件&quot;&gt;&lt;a href=&quot;#三、按钮触发事件&quot; class=&quot;headerlink&quot; title=&quot;三、按钮触发事件&quot;&gt;&lt;/a&gt;三、按钮触发事件&lt;/h1&gt; &lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;submit&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;btn btn-primary&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;pass&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;通过所选&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;javascript&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$(&lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;).ready(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$(&lt;span class=&quot;string&quot;&gt;&quot;input[name=&#39;pass&#39;]&quot;&lt;/span&gt;).click(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;check(&lt;span class=&quot;string&quot;&gt;&quot;hidden-value2&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; 监听name为pass的按钮点击事件，当成也可以在button中添加onclick方法。&lt;/p&gt;
&lt;h1 id=&quot;四、获取table的行列的文本内容，或是值&quot;&gt;&lt;a href=&quot;#四、获取table的行列的文本内容，或是值&quot; class=&quot;headerlink&quot; title=&quot;四、获取table的行列的文本内容，或是值&quot;&gt;&lt;/a&gt;四、获取table的行列的文本内容，或是值&lt;/h1&gt; &lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;var rowsize = document.getElementById(&#39;user-history-body&#39;).getElementsByTagName(&#39;tr&#39;).length&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; 解释：获取tbody—&lt;tbody id=&quot;user-history-body&quot;&gt;，得到其下tr标签的个数。&lt;/tbody&gt;&lt;/p&gt;
 &lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;var td = document .getElementById (&quot;dataTables-user-history&quot;).rows [i+1].cells[8].innerHTML&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; 解释：获取&lt;br&gt; &lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;table table-striped table-bordered table-hover&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;dataTables-user-history&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt; 下tobody的第i+1行第8列的文本&lt;/p&gt;
&lt;h1 id=&quot;五、checkbox的全选和全不选操作&quot;&gt;&lt;a href=&quot;#五、checkbox的全选和全不选操作&quot; class=&quot;headerlink&quot; title=&quot;五、checkbox的全选和全不选操作&quot;&gt;&lt;/a&gt;五、checkbox的全选和全不选操作&lt;/h1&gt;&lt;p&gt;  假设监听的对象的id=”chk_all2”，另外需置所有的checkbox的name=”transPro2”&lt;/p&gt;
 &lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt; //&lt;span class=&quot;comment&quot;&gt;&amp;lt;!--全选与全不选的操作（点击checkbox）--&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$(document).on(&quot;click&quot;,&quot;#chk_all2&quot;,function()&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    var ischecked= $(&quot;#chk_all2:checked&quot;).length&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    var $checkboxs =$(&quot;input[name=&#39;transPro2&#39;]&quot;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    if(ischecked)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        $checkboxs.prop(&quot;checked&quot;,true)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;else&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        $checkboxs.prop(&quot;checked&quot;,false)							 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;//&lt;span class=&quot;comment&quot;&gt;&amp;lt;!--end--&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; 1.可以类似QQ邮箱那样用checkbox控制checkbox&lt;/p&gt;
 &lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;checkbox&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;transPro2&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;chk_all2&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2.用点击文本的方式控制则为:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;```html&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;javascript:void(0)&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;allSelect2&quot;&lt;/span&gt; &amp;gt;&lt;/span&gt;全部&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt; 而javascript改为&lt;br&gt; &lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;javascript&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$(&lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;).on(&lt;span class=&quot;string&quot;&gt;&quot;click&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;#allSelect2&quot;&lt;/span&gt;,&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; $checkboxs =$(&lt;span class=&quot;string&quot;&gt;&quot;input[name=&#39;transPro2&#39;]&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$checkboxs.prop(&lt;span class=&quot;string&quot;&gt;&quot;checked&quot;&lt;/span&gt;,&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt; 注意有些人喜欢将&lt;br&gt; &lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;href=&quot;javascript:void(0)&quot;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt; 改为href=”#”，但这样的话点击之后会使页面回到页首部，太过突兀。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;   以下所讲内容采用bootstrap模板，jquery库，对于原生html大致也同样适用&lt;/p&gt;
&lt;h1 id=&quot;一、侧边栏分页&quot;&gt;&lt;a href=&quot;#一、侧边栏分页&quot; class=&quot;headerlink&quot; title=&quot;一、侧边栏分页&quot;&gt;&lt;/a&gt;一、侧边栏分页&lt;/h1&gt;
    
    </summary>
    
      <category term="前端" scheme="http://enjoyhot.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="js func" scheme="http://enjoyhot.github.io/tags/js-func/"/>
    
  </entry>
  
</feed>
